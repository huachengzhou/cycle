<!DOCTYPE html>
<html lang="en-us">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>MySQL数据库对象与应用 - 禅与摩托车维修艺术</title>
<meta name="description" content="简单的事情重复做,重复的事情用心做,用心的事情坚持做">
<meta name="generator" content="Hugo 0.81.0" />
<link href="https://huachengzhou.github.io/cycle/index.xml" rel="alternate" type="application/rss+xml">
<link rel="canonical" href="https://huachengzhou.github.io/cycle/databases/mysql_163%E8%AF%BE%E5%A0%82/%E7%BD%91%E6%98%93%E4%BA%91%E8%AF%BE%E5%A0%82mysql_chapter2/">
<link rel="stylesheet" href="css/theme.min.css">
<script src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>
<link rel="stylesheet" href="css/chroma.min.css">
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery.easing@1.4.1/jquery.easing.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script>
<script src="js/bundle.js"></script><style>
:root {--custom-font-color: white;--custom-background-color: black;}
</style>
<meta property="og:title" content="MySQL数据库对象与应用" />
<meta property="og:description" content="MySQL数据库对象与应用 2.1-MySQL数据类型 Number不止一种 整形 浮点型 整形 INT SMALLINT MEDIUMINT BIGINT type Storage Minumun Value Maximum Value (Bytes) (Signed/Unsigned) (Signed/Unsigned) TINYINT 1 -128 127 0 255 SMALLINT 2 -32768 32767 0 65535 MEDIUMINT 3" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://huachengzhou.github.io/cycle/databases/mysql_163%E8%AF%BE%E5%A0%82/%E7%BD%91%E6%98%93%E4%BA%91%E8%AF%BE%E5%A0%82mysql_chapter2/" /><meta property="og:image" content="https://huachengzhou.github.io/cycle/images/og-image.png"/><meta property="article:section" content="databases" />
<meta property="article:published_time" content="2020-01-17T15:26:15&#43;00:00" />
<meta property="article:modified_time" content="2020-01-17T15:26:15&#43;00:00" /><meta property="og:site_name" content="向卓越致敬" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://huachengzhou.github.io/cycle/images/og-image.png"/>

<meta name="twitter:title" content="MySQL数据库对象与应用"/>
<meta name="twitter:description" content="MySQL数据库对象与应用 2.1-MySQL数据类型 Number不止一种 整形 浮点型 整形 INT SMALLINT MEDIUMINT BIGINT type Storage Minumun Value Maximum Value (Bytes) (Signed/Unsigned) (Signed/Unsigned) TINYINT 1 -128 127 0 255 SMALLINT 2 -32768 32767 0 65535 MEDIUMINT 3"/>
<meta itemprop="name" content="MySQL数据库对象与应用">
<meta itemprop="description" content="MySQL数据库对象与应用 2.1-MySQL数据类型 Number不止一种 整形 浮点型 整形 INT SMALLINT MEDIUMINT BIGINT type Storage Minumun Value Maximum Value (Bytes) (Signed/Unsigned) (Signed/Unsigned) TINYINT 1 -128 127 0 255 SMALLINT 2 -32768 32767 0 65535 MEDIUMINT 3"><meta itemprop="datePublished" content="2020-01-17T15:26:15&#43;00:00" />
<meta itemprop="dateModified" content="2020-01-17T15:26:15&#43;00:00" />
<meta itemprop="wordCount" content="13918"><meta itemprop="image" content="https://huachengzhou.github.io/cycle/images/og-image.png"/>
<meta itemprop="keywords" content="" /></head>
<body><div class="container"><header>
<h1>禅与摩托车维修艺术</h1>
<p class="description">简单的事情重复做,重复的事情用心做,用心的事情坚持做</p>

</header>
<div class="global-menu">
<nav>
<ul>
<li><a href="https://huachengzhou.github.io/cycle/">home</a></li>
<li><a href="https://huachengzhou.github.io/cycle/javadir/"> Java技术栈</a></li>
<li><a href="https://huachengzhou.github.io/cycle/databases/"> 数据库</a></li>
<li><a href="https://huachengzhou.github.io/cycle/about/">关于程序员</a></li>
<li><a href="https://huachengzhou.github.io/cycle/post/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/">编译原理</a></li>
<li><a href="https://huachengzhou.github.io/cycle/post/website/">网站链接</a></li>
<li><a href="https://huachengzhou.github.io/cycle/post/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/">计算机组成原理</a></li></ul>
</nav>
</div>
<div class="content-container">
<main><h1>MySQL数据库对象与应用</h1>
<h1 id="mysql数据库对象与应用">MySQL数据库对象与应用</h1>
<h2 id="21-mysql数据类型">2.1-MySQL数据类型</h2>
<h3 id="number不止一种">Number不止一种</h3>
<ul>
<li>整形</li>
<li>浮点型</li>
</ul>
<h3 id="整形">整形</h3>
<ul>
<li>INT</li>
<li>SMALLINT</li>
<li>MEDIUMINT</li>
<li>BIGINT</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">type</th>
<th style="text-align:left">Storage</th>
<th style="text-align:left">Minumun Value</th>
<th style="text-align:left">Maximum Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">(Bytes)</td>
<td style="text-align:left">(Signed/Unsigned)</td>
<td style="text-align:left">(Signed/Unsigned)</td>
</tr>
<tr>
<td style="text-align:left">TINYINT</td>
<td style="text-align:left">1</td>
<td style="text-align:left">-128</td>
<td style="text-align:left">127</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">0</td>
<td style="text-align:left">255</td>
</tr>
<tr>
<td style="text-align:left">SMALLINT</td>
<td style="text-align:left">2</td>
<td style="text-align:left">-32768</td>
<td style="text-align:left">32767</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">0</td>
<td style="text-align:left">65535</td>
</tr>
<tr>
<td style="text-align:left">MEDIUMINT</td>
<td style="text-align:left">3</td>
<td style="text-align:left">-8388608</td>
<td style="text-align:left">8388607</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">0</td>
<td style="text-align:left">16777215</td>
</tr>
<tr>
<td style="text-align:left">INT</td>
<td style="text-align:left">4</td>
<td style="text-align:left">-2147483648</td>
<td style="text-align:left">2147483647</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">0</td>
<td style="text-align:left">4294967295</td>
</tr>
<tr>
<td style="text-align:left">BIGINT</td>
<td style="text-align:left">8</td>
<td style="text-align:left">-9223372036854775808</td>
<td style="text-align:left">9223372036854775807</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">0</td>
<td style="text-align:left">18446744073709551615</td>
</tr>
</tbody>
</table>
<h3 id="老生常谈的问题">老生常谈的问题</h3>
<p><strong>int(11) VS int(21)</strong>
存储空间，还是存储范围有区别？</p>
<p>答案是：<strong>两者完全一样</strong>，只是在显示的时候补全0的位数不一样。</p>
<p>可以通过下面的例子来验证：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> t(a int(<span style="color:#ae81ff">11</span>) zerofill, b int(<span style="color:#ae81ff">21</span>) zerofill);
<span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> t <span style="color:#66d9ef">values</span> (<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>);
<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> t;
</code></pre></div><p>MySQL默认是不带0补全的。</p>
<p>只是在一些特殊情况下两者显示有区别，其本质完全一样。</p>
<h3 id="浮点型">浮点型</h3>
<ul>
<li>FLOAT(M, D)</li>
<li>DOUBLE(M, D)</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">属性</th>
<th style="text-align:left">存储空间</th>
<th style="text-align:left">精度</th>
<th style="text-align:left">精确性</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Float</td>
<td style="text-align:left">4 bytes</td>
<td style="text-align:left">单精度</td>
<td style="text-align:left">非精确</td>
</tr>
<tr>
<td style="text-align:left">Double</td>
<td style="text-align:left">8 bytes</td>
<td style="text-align:left">双精度</td>
<td style="text-align:left">比Float精度高</td>
</tr>
</tbody>
</table>
<h3 id="精度丢失问题">精度丢失问题</h3>
<ul>
<li>精度丢失</li>
</ul>
<p>一个例子：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> t(a int(<span style="color:#ae81ff">11</span>), b float(<span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">4</span>));
<span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> t <span style="color:#66d9ef">values</span> (<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">123</span>.<span style="color:#ae81ff">12345</span>);
<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> t;
</code></pre></div><h3 id="定点数-更精确的数字类型">定点数-更精确的数字类型</h3>
<ul>
<li>DECIMAL
<ul>
<li>高精度的数据类型，常用来存储交易相关的数据</li>
<li>DECIMAL(M,N).M代表总精度，N代表小数点右侧的位数（标度）</li>
<li>1 &lt; M &lt; 254, 0 &lt; N &lt; 60;</li>
<li>存储空间变长</li>
</ul>
</li>
</ul>
<h3 id="性别省份信息">性别、省份信息</h3>
<p>一般使用tinyint、char(1)、enum类型。</p>
<h3 id="经验之谈">经验之谈</h3>
<ul>
<li>存储性别、省份、类型等分类信息时选择TINYINT或者ENUM</li>
<li>BIGINT存储空间更大，INT和BIGINT之间通常选择BIGINT</li>
<li>交易等高精度数据选择使用DECIMAL</li>
</ul>
<h3 id="存储用户名的属性">存储用户名的属性</h3>
<ul>
<li>CHAR</li>
<li>VARCHAR</li>
<li>TEXT</li>
</ul>
<h3 id="cahr与varchar">CAHR与VARCHAR</h3>
<ul>
<li>CHAR和VARCHAR存储的单位都是字符</li>
<li>CHAR存储定长，容易造成空间的浪费</li>
<li>VARCHAR存储变长，节省存储空间</li>
</ul>
<h3 id="字符与字节的区别">字符与字节的区别</h3>
<table>
<thead>
<tr>
<th style="text-align:left">编码\输入字符串</th>
<th style="text-align:left">网易</th>
<th style="text-align:left">netease</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">gbk(双字节)</td>
<td style="text-align:left">varchar(2)/4 bytes</td>
<td style="text-align:left">varchar(7)/7 bytes</td>
</tr>
<tr>
<td style="text-align:left">utf8(三字节)</td>
<td style="text-align:left">varchar(2)/6 bytes</td>
<td style="text-align:left">varchar(7)/7 bytes</td>
</tr>
<tr>
<td style="text-align:left">utf8mb4(四字节)</td>
<td style="text-align:left">varchar(2) ?</td>
<td style="text-align:left">varchar(7)/7 bytes</td>
</tr>
</tbody>
</table>
<p>对于utf8mb4号称占用四字节但是并不绝对。如果在utf8可以覆盖到的范围则仍然占用3字节。</p>
<p>utf8mb4最有优势的应用场景是用于存储emoji表情</p>
<h3 id="emoji表情">emoji表情</h3>
<ul>
<li>MySQL版本 &gt; 5.5.3</li>
<li>JDBC驱动版本 &gt; 5.1.13</li>
<li>库和表的编码设为utf8mb4</li>
</ul>
<h3 id="text与char和varchar的区别">TEXT与CHAR和VARCHAR的区别</h3>
<ul>
<li>CHAR和VARCHAR存储单位为字符</li>
<li>TEXT存储单位为字节，总大小为65535字节，约为64KB</li>
<li>CHAR数据类型最大为255字符</li>
<li>VARCHAR数据类型为变长存储，可以超过255个字符</li>
<li>TEXT在MySQL内部大多存储格式为溢出页，效率不如CHAR</li>
</ul>
<p>一个例子：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> t (a char(<span style="color:#ae81ff">256</span>));
<span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> t (a varchar(<span style="color:#ae81ff">256</span>));
</code></pre></div><h3 id="存储头像">存储头像</h3>
<ul>
<li>BLOB</li>
<li>BINARY</li>
</ul>
<p>性能太差，不推荐</p>
<h3 id="经验之谈-1">经验之谈</h3>
<ul>
<li>CHAR与VARCHAR定义的长度是字符长度不是字节长度</li>
<li>存储字符串推荐使用VARCHAR(N),N尽量小</li>
<li>虽然数据库可以存储二进制数据，但是性能低下，不要使用数据库存储文件音频等二进制数据</li>
</ul>
<h3 id="存储生日信息">存储生日信息</h3>
<ul>
<li>DATE</li>
<li>TIME</li>
<li>DATETIME</li>
<li>TIMESTAMP</li>
<li>BIGINT</li>
</ul>
<h3 id="时间类型的区别在哪里">时间类型的区别在哪里</h3>
<ul>
<li>
<p>存储空间上的区别</p>
<ul>
<li>DATE三字节，如：2015-05-01</li>
<li>TIME三字节，如：11:12:00</li>
<li>TIMESTAMP，如：2015-05-01 11::12:00</li>
<li>DATETIME八字节，如：2015-05-01 11::12:00</li>
</ul>
</li>
<li>
<p>存储精度的区别</p>
<ul>
<li>DATE精确到年月日</li>
<li>TIME精确到小时分钟和秒</li>
<li>TIMESTAMP、DATETIME都包含上述两者</li>
</ul>
</li>
</ul>
<h3 id="timestamp-vs-datetime">TIMESTAMP VS DATETIME</h3>
<ul>
<li>存储范围的区别
<ul>
<li>TIMESTAMP存储范围：1970-01-01 00::00:01 to 2038-01-19 03:14:07</li>
<li>DATETIME的存储范围：1000-01-01 00:00:00 to 9999-12-31 23:59:59</li>
</ul>
</li>
</ul>
<p>MySQL在5.6.4版本之后，TimeStamp和DateTime支持到微妙</p>
<ul>
<li>字段类型与市区的关联关系
<ul>
<li>TIMESTAMP会根据系统时区进行转换，DATETIME则不会</li>
</ul>
</li>
</ul>
<h3 id="字段类型和时区的关系">字段类型和时区的关系</h3>
<ul>
<li>国际化的系统</li>
</ul>
<p>一个例子：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> test (a datetime, b <span style="color:#66d9ef">timestamp</span>);
<span style="color:#66d9ef">select</span> now();
<span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> test <span style="color:#66d9ef">values</span> (now(), now());
<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> test;
<span style="color:#66d9ef">set</span> time_zone <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;+00:00&#39;</span>;
<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> test;
</code></pre></div><h3 id="bigint如何存储时间类型">BIGINT如何存储时间类型</h3>
<ul>
<li>应用程序将时间转换为数字类型</li>
</ul>
<h2 id="22-mysql数据对象">2.2-MySQL数据对象</h2>
<h3 id="mysql常见的数据对象有哪些">MySQL常见的数据对象有哪些</h3>
<ul>
<li>DataBase/Schema</li>
<li>Table</li>
<li>Index</li>
<li>View/Trigger/Function/Procedure</li>
</ul>
<h3 id="库表行层级关系">库、表、行层级关系</h3>
<ul>
<li>一个DataBase对应一个Schema</li>
<li>一个Schema包含一个或多个表</li>
<li>一个表里面包含一个或多个字段</li>
<li>一个表里包含一条或多条记录</li>
<li>一个表包含一个或多个索引</li>
</ul>
<h3 id="多database用途">多DataBase用途</h3>
<ul>
<li>业务隔离</li>
<li>资源隔离</li>
</ul>
<h3 id="表上有哪些常用的数据对象">表上有哪些常用的数据对象</h3>
<ul>
<li>索引</li>
<li>约束</li>
<li>视图、触发器、函数、存储过程</li>
</ul>
<h3 id="什么是数据库索引">什么是数据库索引</h3>
<ul>
<li>读书的时候如何快速定位某一章节
<ul>
<li>查找书籍目录</li>
<li>在自己喜欢的章节加书签，直接定位</li>
</ul>
</li>
<li>索引就是数据库中的数据的目录（索引和数据是分开存储的）
<ul>
<li>索引和数据是两个对象</li>
<li>索引主要是用来提高数据库的查询效率</li>
<li>数据库中数据变更同样需要同步索引数据的变更</li>
</ul>
</li>
</ul>
<h2 id="如何创建索引一">如何创建索引（一）</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> [<span style="color:#66d9ef">UNIQUE</span><span style="color:#f92672">|</span>FULLTEXT<span style="color:#f92672">|</span>SPATIAL] <span style="color:#66d9ef">INDEX</span> index_name
  [index_type]
  <span style="color:#66d9ef">ON</span> tbl_name (index_col_name,...)
  [index_option]
  [algorithm_option <span style="color:#f92672">|</span> lock_option] ...

index_col_name:
  col_name [(<span style="color:#66d9ef">length</span>)] [<span style="color:#66d9ef">ASC</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">DESC</span>]

index_type:
  <span style="color:#66d9ef">USING</span> <span style="color:#960050;background-color:#1e0010">{</span>BTREE <span style="color:#f92672">|</span> HASH<span style="color:#960050;background-color:#1e0010">}</span>
</code></pre></div><h2 id="如何创建索引二">如何创建索引（二）</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">ALTER</span> [<span style="color:#66d9ef">IGNORE</span>] <span style="color:#66d9ef">TABLE</span> tbl_name
  [alter_specification [, alter_specification] ...]
  [partition_options]

alter_specification:
    table_options
  <span style="color:#f92672">|</span> <span style="color:#66d9ef">ADD</span> [<span style="color:#66d9ef">COLUMN</span>] col_name column_definition
        [<span style="color:#66d9ef">FIRST</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">AFTER</span> col_name]
    <span style="color:#66d9ef">ADD</span> [<span style="color:#66d9ef">COLUMN</span>] (col_name column_definition,...)
    <span style="color:#66d9ef">ADD</span> <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#66d9ef">INDEX</span><span style="color:#f92672">|</span><span style="color:#66d9ef">KEY</span><span style="color:#960050;background-color:#1e0010">}</span> [index_name]
        [index_type] (index_col_name,...) [index_option] ...
  <span style="color:#f92672">|</span> <span style="color:#66d9ef">ADD</span> [<span style="color:#66d9ef">CONSTRAINT</span> [symbol]] <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>
        [index_type] (index_col_name,...) [index_option] ...
  <span style="color:#f92672">|</span> <span style="color:#66d9ef">ADD</span> [<span style="color:#66d9ef">CONSTRAINT</span> [symbol]]
        <span style="color:#66d9ef">UNIQUE</span> [<span style="color:#66d9ef">INDEX</span><span style="color:#f92672">|</span><span style="color:#66d9ef">KEY</span>] [index_name]
</code></pre></div><h3 id="约束">约束</h3>
<ul>
<li>生活中的约束有哪些
<ul>
<li>每个人的指纹信息必须唯一</li>
<li>每个人的身份证要求唯一</li>
<li>网上购物需要先登录才能下单</li>
</ul>
</li>
<li>唯一约束
<ul>
<li>对一张表的某个字段或者某几个字段设置唯一键约束，保证在这个表里对应的数据必须唯一，如：用户ID、手机号、身份证等。</li>
</ul>
</li>
</ul>
<h3 id="创建唯一约束">创建唯一约束</h3>
<ul>
<li>唯一约束是一种特殊的索引</li>
<li>唯一约束可以是一个或者多个字段</li>
<li>唯一约束可以在创建表的时候建好，也可以后面再补上</li>
<li>主键也是一种唯一约束</li>
</ul>
<h3 id="唯一约束">唯一约束</h3>
<p>以如下这张表为例</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#f92672">`</span><span style="color:#66d9ef">order</span><span style="color:#f92672">`</span> (
  <span style="color:#f92672">`</span>id<span style="color:#f92672">`</span> int(<span style="color:#ae81ff">10</span>) unsigned <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> AUTO_INCREMENT,
  <span style="color:#f92672">`</span>orderid<span style="color:#f92672">`</span> int(<span style="color:#ae81ff">10</span>) unsigned <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
  <span style="color:#f92672">`</span>bookid<span style="color:#f92672">`</span> int(<span style="color:#ae81ff">10</span>) unsigned <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;0&#39;</span>,
  <span style="color:#f92672">`</span>userid<span style="color:#f92672">`</span> int(<span style="color:#ae81ff">10</span>) unsigned <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;0&#39;</span>,
  <span style="color:#f92672">`</span>number<span style="color:#f92672">`</span> tinyint(<span style="color:#ae81ff">3</span>) unsigned <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;0&#39;</span>,
  <span style="color:#f92672">`</span>address<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">128</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;&#39;</span>,
  <span style="color:#f92672">`</span>postcode<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">128</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;&#39;</span>,
  <span style="color:#f92672">`</span>orderdate<span style="color:#f92672">`</span> datetime <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;0000-00-00 00:00:00&#39;</span>,
  <span style="color:#f92672">`</span>status<span style="color:#f92672">`</span> tinyint(<span style="color:#ae81ff">3</span>) unsigned zerofill <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;000&#39;</span>,
  <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span> (<span style="color:#f92672">`</span>id<span style="color:#f92672">`</span>),
  <span style="color:#66d9ef">UNIQUE</span> <span style="color:#66d9ef">KEY</span> <span style="color:#f92672">`</span>idx_orderid<span style="color:#f92672">`</span> (<span style="color:#f92672">`</span>orderid<span style="color:#f92672">`</span>),
  <span style="color:#66d9ef">UNIQUE</span> <span style="color:#66d9ef">KEY</span> <span style="color:#f92672">`</span>idx_uid_orderid<span style="color:#f92672">`</span> (<span style="color:#f92672">`</span>userid<span style="color:#f92672">`</span>, <span style="color:#f92672">`</span>orderid<span style="color:#f92672">`</span>),
  <span style="color:#66d9ef">KEY</span> <span style="color:#f92672">`</span>bookid<span style="color:#f92672">`</span> (<span style="color:#f92672">`</span>bookid<span style="color:#f92672">`</span>)
) ENGINE<span style="color:#f92672">=</span>InnoDB <span style="color:#66d9ef">DEFAULT</span> CHARSET<span style="color:#f92672">=</span>utf8
</code></pre></div><ul>
<li>索引有哪些
<ul>
<li>主键索引 ID</li>
<li>单键索引 orderid</li>
<li>单键索引 bookid</li>
<li>组合索引 (userid + orderid)</li>
</ul>
</li>
<li>唯一约束有哪些
<ul>
<li>主键约束      (ID)</li>
<li>单键唯一索引   (orderid)</li>
<li>组合唯一索引   (userid + orderid)</li>
</ul>
</li>
</ul>
<h3 id="添加唯一约束">添加唯一约束</h3>
<ul>
<li>添加主键
<ul>
<li>alter table `order` add primary key (id);</li>
</ul>
</li>
<li>添加唯一索引
<ul>
<li>alter table `order` add unique key idx_uk_orderid (orderid);</li>
</ul>
</li>
</ul>
<h3 id="外键约束">外键约束</h3>
<ul>
<li>外键指两张表的数据通过某种条件关联起来</li>
</ul>
<h3 id="创建外键约束">创建外键约束</h3>
<ul>
<li>将用户表和订单表通过外键关联起来
<ul>
<li>alter table `order` add CONSTRAINT constraint_uid FOREIGN KEY (userid) REFERENCES user(userid);</li>
</ul>
</li>
<li>使用外键的注意事项
<ul>
<li>必须是INNODB表，Myisam和其他引擎不支持外键</li>
<li>相互约束的字段类型必须要求一样</li>
<li>主表的约束字段要求有索引</li>
<li>约束名称必须要唯一，即使不在一张表上</li>
</ul>
</li>
</ul>
<h3 id="view">View</h3>
<ul>
<li>产品需求
<ul>
<li>假如有其他部门的同事想查询我们数据库里的数据，但是我们并不想暴露表结构，并且只提供给他们部分数据</li>
</ul>
</li>
</ul>
<h3 id="view的作用">View的作用</h3>
<ul>
<li>视图将一组查询语句构成的结果集，是一种虚拟结构，并不是实际数据</li>
<li>视图能简化数据库的访问，能够将多个查询语句结构化为一个虚拟结构</li>
<li>视图可以隐藏数据库后端表结构，提高数据库安全性</li>
<li>视图也是一种权限管理，只对用户提供部分数据</li>
</ul>
<h3 id="创建view">创建View</h3>
<ul>
<li>创建已完成订单的视图
<ul>
<li>create view order_view as select * from `order` where status=1;</li>
</ul>
</li>
</ul>
<h3 id="trigger">Trigger</h3>
<ul>
<li>产品需求
<ul>
<li>随着客户个人等级的提升， 系统需要自动更新用户的积分，其中一共有两张表，分别为：用户信息表和积分表</li>
</ul>
</li>
<li>Trigger俗称触发器，指可以在数据写入表A之前或者之后可以做一些其他动作</li>
<li>使用Trigger在每次更新用户表的时候出发更新积分表</li>
</ul>
<h3 id="除此之外还有哪些">除此之外还有哪些</h3>
<ul>
<li>Function</li>
<li>Procedure</li>
</ul>
<h2 id="23-mysql权限管理">2.3-MySQL权限管理</h2>
<h3 id="连接mysql的必要条件">连接MySQL的必要条件</h3>
<ul>
<li>网络要通畅</li>
<li>用户名和密码要正确</li>
<li>数据库需要加IP白名单</li>
<li>更细粒度的验证（库、表、列权限类型等等）</li>
</ul>
<h3 id="数据有哪些权限">数据有哪些权限</h3>
<p><code>show privileges</code>命令可以查看全部权限</p>
<h3 id="权限粒度">权限粒度</h3>
<ul>
<li>Data Privileges
<ul>
<li>DATA: SELECT, INSERT, UPDATE, DELETE</li>
</ul>
</li>
<li>Definition Privileges
<ul>
<li>DataBase: CREATE, ALTER, DROP</li>
<li>Table: CREATE, ALTER, DROP</li>
<li>VIEW/FUNCTION/TRIGGER/PROCEDURE: CREATE, ALTER, DROP</li>
</ul>
</li>
<li>Administrator Privileges
<ul>
<li>Shutdown DataBase</li>
<li>Replication Slave</li>
<li>Replication Client</li>
<li>File Privilege</li>
</ul>
</li>
</ul>
<h3 id="mysql赋权操作">MySQL赋权操作</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">GRANT</span>
  priv_type [(column_list)]
    [, priv_type [column_list]] ...
  <span style="color:#66d9ef">ON</span> [object_type] priv_level
  <span style="color:#66d9ef">TO</span> user_specification [, user_specification] ...
  [REQUIRE <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#66d9ef">NONE</span> <span style="color:#f92672">|</span> ssl_option [[<span style="color:#66d9ef">AND</span>] ssl_option] ...<span style="color:#960050;background-color:#1e0010">}</span>]
  [<span style="color:#66d9ef">WITH</span> with_option ...]
<span style="color:#66d9ef">GRANT</span> PROXY <span style="color:#66d9ef">ON</span> user_specification
  <span style="color:#66d9ef">TO</span> user_specification [, user_specification] ...
  [<span style="color:#66d9ef">WITH</span> <span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">OPTION</span>]
</code></pre></div><h3 id="如何新建一个用户并赋权">如何新建一个用户并赋权</h3>
<ul>
<li>使用MySQL自带的命令
<ul>
<li><code>CREATE USER 'netease'@'localhost' IDENTIFIED BY 'netease163';</code></li>
<li><code>GRANT SELECT ON *.* TO 'netease'@'localhost' WITH GRANT OPTION;</code></li>
</ul>
</li>
</ul>
<h3 id="其他方法">其他方法</h3>
<ul>
<li>更改数据库记录
<ul>
<li>首先向User表里面插入一条记录，根据自己的需要选择是否向db和table_pirv表插入记录</li>
<li>执行<code>flush privileges</code>命令，让权限信息生效</li>
</ul>
</li>
</ul>
<h3 id="更简单的办法">更简单的办法</h3>
<ul>
<li>GRANT语句会判断是否存在该用户，如果不存在则新建
<ul>
<li><code>GRANT SELECT ON *.* TO 'NETEASE'@'localhost' IDENTIFIED BY 'netease163' WITH GRANT OPTION;</code></li>
</ul>
</li>
</ul>
<h3 id="查看用户的权限信息">查看用户的权限信息</h3>
<ul>
<li>查看当前用户的权限
<ul>
<li><code>show grants;</code></li>
</ul>
</li>
<li>查看其它用户的权限
<ul>
<li><code>show grants for netease@'localhost';</code></li>
</ul>
</li>
</ul>
<h3 id="如何更改用户的权限">如何更改用户的权限</h3>
<ul>
<li>回收不需要的权限
<ul>
<li><code>revoke select on *.* from netease@'localhost';</code></li>
</ul>
</li>
<li>重新赋权
<ul>
<li><code>grant insert on *.* to netease@'localhost';</code></li>
</ul>
</li>
</ul>
<h3 id="如何更改用户密码">如何更改用户密码</h3>
<ul>
<li>用新密码，grant语句重新授权</li>
<li>更改数据库记录，Update User表的Password字段
<ul>
<li>注意：用这种办法，更改完需要flush privileges刷新权限信息，不推荐</li>
</ul>
</li>
</ul>
<h3 id="删除用户">删除用户</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">USER</span> <span style="color:#66d9ef">user</span> [, <span style="color:#66d9ef">user</span>] ...
</code></pre></div><h3 id="with-grant-option">With Grant Option</h3>
<ul>
<li>允许被授予权利的人把这个权利授予其他的人</li>
</ul>
<h3 id="mysql权限信息存储结构">MySQL权限信息存储结构</h3>
<ul>
<li>MySQL权限信息是存在数据库表中</li>
<li>MySQL账号对应的密码也加密存储在数据库表中</li>
<li>每一种权限类型在元数据里都是枚举类型，表明是否有该权限</li>
</ul>
<h3 id="有哪些权限相关的表">有哪些权限相关的表</h3>
<ul>
<li>user</li>
<li>db</li>
<li>table_pirv</li>
<li>columns_pirv</li>
<li>host</li>
</ul>
<h3 id="权限验证流程">权限验证流程</h3>
<p>查询时从user-&gt;db-&gt;table_pirv-&gt;columns_pirv依次验证，如果通过则执行查询。</p>
<h3 id="小结">小结</h3>
<ul>
<li>MySQL权限信息都是以数据记录的形式存储在数据库的表中。</li>
<li>MySQL的权限验证相比网站登录多了白名单环节，并且粒度更细，可以精确到表和字段。</li>
</ul>
<h3 id="mysql权限上有哪些问题">MySQL权限上有哪些问题</h3>
<ul>
<li>使用Binary二进制安装管理用户没有设置密码</li>
<li>MySQL默认的test库不受权限控制，存在安全风险</li>
</ul>
<h3 id="mysql_secure_installation">mysql_secure_installation</h3>
<ul>
<li>You can set a Password for root accounts.</li>
<li>You can remove root accounts that are accessible from outside the localhost.</li>
<li>You can remove anonymous-user accounts.</li>
<li>You can remove the test database.</li>
</ul>
<h3 id="小结-1">小结</h3>
<ul>
<li>权限相关的操作不要直接操作表，统一使用MySQL命令。</li>
<li>使用二进制安装MySQL安装后，需要重置管理用户(root)的密码。</li>
<li>线上数据库不要留test库</li>
</ul>
<h2 id="实践课数据库对象">实践课：数据库对象</h2>
<h3 id="何为表结构设计">何为表结构设计</h3>
<ul>
<li>表结构设计需要在正式进行开发之前完成</li>
<li>根据产品需求将复杂的业务模型抽象出来</li>
</ul>
<h3 id="设计表的时候需要注意哪些">设计表的时候需要注意哪些</h3>
<ul>
<li>理解各个表的依赖关系</li>
<li>理解各个表的功能特点
<ul>
<li>字段之间的约束、索引</li>
<li>字段类型、字段长度</li>
</ul>
</li>
</ul>
<h3 id="收集表属性">收集表属性</h3>
<ul>
<li>昵称</li>
<li>生日</li>
<li>性别</li>
<li>手机号码</li>
<li>住宅号码</li>
<li>邮编</li>
<li>住宅地址</li>
<li>注册地址</li>
<li>登录IP</li>
<li>上一次登录时间</li>
<li>邮件地址</li>
</ul>
<h3 id="理解表的功能特点数据用途">理解表的功能特点——数据用途</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> tb_account(
  account_id int <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span> auto_increment <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span>,
  nick_name varchar(<span style="color:#ae81ff">20</span>),
  true_name varchar(<span style="color:#ae81ff">20</span>),
  sex char(<span style="color:#ae81ff">1</span>),
  mail_address varchar(<span style="color:#ae81ff">50</span>),
  phone1 varchar(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>,
  phone2 varchar(<span style="color:#ae81ff">20</span>),
  password varchar(<span style="color:#ae81ff">30</span>) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>,
  create_time datetime,
  account_state tinyint,
  last_login_time datetime,
  last_login_ip varchar(<span style="color:#ae81ff">20</span>)
) ENGINE<span style="color:#f92672">=</span>InnoDB <span style="color:#66d9ef">DEFAULT</span> CHARSET<span style="color:#f92672">=</span>utf8mb4

<span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> tb_goods(
  good_id bigint <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span> auto_increment <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span>,
  goods_name varchar(<span style="color:#ae81ff">100</span>) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>,
  pic_url varchar(<span style="color:#ae81ff">500</span>) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>,
  store_quantity int <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>,
  goods_note varchar(<span style="color:#ae81ff">4096</span>),
  producer varchar(<span style="color:#ae81ff">500</span>),
  category_id int <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>
) ENGINE<span style="color:#f92672">=</span>InnoDB <span style="color:#66d9ef">DEFAULT</span> CHARSET<span style="color:#f92672">=</span>utf8mb4

<span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> tb_goods_category(
  category_id int <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span> auto_increment <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span>,
  category_level smallint <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>,
  category_name varchar(<span style="color:#ae81ff">500</span>),
  upper_category_id int <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>
) ENGINE<span style="color:#f92672">=</span>InnoDB <span style="color:#66d9ef">DEFAULT</span> CHARSET<span style="color:#f92672">=</span>utf8mb4

<span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> tb_order(
  order_id bigint <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span> auto_increment <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span>,
  account_id int <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>,
  create_time datetime,
  order_amount decimal(<span style="color:#ae81ff">12</span>,<span style="color:#ae81ff">2</span>),
  order_state tinyint,
  update_time datetime,
  order_ip varchar(<span style="color:#ae81ff">20</span>),
  pay_method varchar(<span style="color:#ae81ff">20</span>),
  user_notes varchar(<span style="color:#ae81ff">500</span>)
) ENGINE<span style="color:#f92672">=</span>InnoDB <span style="color:#66d9ef">DEFAULT</span> CHARSET<span style="color:#f92672">=</span>utf8mb4

<span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> tb_order_item(
  order_item_id bigint <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span> auto_increment <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span>,
  order_id bigint <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>,
  goods_id bigint <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>,
  goods_quantity int <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>,
  goods_amount decimal(<span style="color:#ae81ff">12</span>,<span style="color:#ae81ff">2</span>),
  uique <span style="color:#66d9ef">key</span> uk_order_goods(order_id, goods_id)
) ENGINE<span style="color:#f92672">=</span>InnoDB <span style="color:#66d9ef">DEFAULT</span> CHARSET<span style="color:#f92672">=</span>utf8mb4
</code></pre></div><h3 id="数据类型命名规范">数据类型——命名规范</h3>
<ul>
<li>所有表名，字段名全部使用小写字母</li>
<li>不同业务，表名使用不同前缀区分。</li>
<li>生成环境表名字段名要有实际意义</li>
<li>单个字段尽量使用字段全名；多个字段之间用下划线分隔</li>
</ul>
<h3 id="字段设计规范">字段设计规范</h3>
<ul>
<li>字段类型选择，尽量选择能满足应用要求的最小数据类型</li>
<li>尽量使用整形代替字符型。整形在字段长度、索引大小等方面开销小效率更高，如邮编字段，手机号码等</li>
<li>注释，每个字段必须以comment语句给出字段的作用</li>
<li>经常访问的大字段需要单独放到一张表中，避免降低sql效率，图片、电影等大文件数据禁止存数据库</li>
<li>新业务统一建议使用utf8mb4字符集</li>
</ul>
<h3 id="用户赋权">用户赋权</h3>
<ul>
<li>理解用户到底需要什么权限
<ul>
<li>普通用户只有数据读写权限</li>
<li>系统管理员具有super权限</li>
</ul>
</li>
<li>权限粒度要做到尽可能的细
<ul>
<li>普通用户不要设置with grant option属性</li>
<li>权限粒度：系统层面&gt;库层面&gt;表层面&gt;字段层面</li>
</ul>
</li>
<li>禁止简单密码
<ul>
<li>线上密码要求随机</li>
</ul>
</li>
</ul>
<h2 id="24-sql语言进阶">2.4-SQL语言进阶</h2>
<p>本课程涉及建表SQL</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#75715e">-- ----------------------------
</span><span style="color:#75715e">-- Table structure for `play_fav`
</span><span style="color:#75715e">-- ----------------------------
</span><span style="color:#75715e"></span><span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">EXISTS</span> <span style="color:#f92672">`</span>play_fav<span style="color:#f92672">`</span>;
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#f92672">`</span>play_fav<span style="color:#f92672">`</span> (
  <span style="color:#f92672">`</span>userid<span style="color:#f92672">`</span> bigint(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;收藏用户id&#39;</span>,
  <span style="color:#f92672">`</span>play_id<span style="color:#f92672">`</span> bigint(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;歌单id&#39;</span>,
  <span style="color:#f92672">`</span>createtime<span style="color:#f92672">`</span> bigint(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;收藏时间&#39;</span>,
  <span style="color:#f92672">`</span>status<span style="color:#f92672">`</span> int(<span style="color:#ae81ff">11</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;0&#39;</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;状态，是否删除&#39;</span>,
  <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span> (<span style="color:#f92672">`</span>play_id<span style="color:#f92672">`</span>,<span style="color:#f92672">`</span>userid<span style="color:#f92672">`</span>),
  <span style="color:#66d9ef">KEY</span> <span style="color:#f92672">`</span>IDX_USERID<span style="color:#f92672">`</span> (<span style="color:#f92672">`</span>userid<span style="color:#f92672">`</span>)
) ENGINE<span style="color:#f92672">=</span>InnoDB <span style="color:#66d9ef">DEFAULT</span> CHARSET<span style="color:#f92672">=</span>utf8 <span style="color:#66d9ef">COMMENT</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;歌单收藏表&#39;</span>;

<span style="color:#75715e">-- ----------------------------
</span><span style="color:#75715e">-- Records of play_fav
</span><span style="color:#75715e">-- ----------------------------
</span><span style="color:#75715e"></span><span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> play_fav <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;2&#39;</span>, <span style="color:#e6db74">&#39;0&#39;</span>, <span style="color:#e6db74">&#39;0&#39;</span>, <span style="color:#e6db74">&#39;0&#39;</span>);
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> play_fav <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;116&#39;</span>, <span style="color:#e6db74">&#39;1&#39;</span>, <span style="color:#e6db74">&#39;1430223383&#39;</span>, <span style="color:#e6db74">&#39;0&#39;</span>);
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> play_fav <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;143&#39;</span>, <span style="color:#e6db74">&#39;1&#39;</span>, <span style="color:#e6db74">&#39;0&#39;</span>, <span style="color:#e6db74">&#39;0&#39;</span>);
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> play_fav <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;165&#39;</span>, <span style="color:#e6db74">&#39;2&#39;</span>, <span style="color:#e6db74">&#39;0&#39;</span>, <span style="color:#e6db74">&#39;0&#39;</span>);
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> play_fav <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;170&#39;</span>, <span style="color:#e6db74">&#39;3&#39;</span>, <span style="color:#e6db74">&#39;0&#39;</span>, <span style="color:#e6db74">&#39;0&#39;</span>);
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> play_fav <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;185&#39;</span>, <span style="color:#e6db74">&#39;3&#39;</span>, <span style="color:#e6db74">&#39;0&#39;</span>, <span style="color:#e6db74">&#39;0&#39;</span>);
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> play_fav <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;170&#39;</span>, <span style="color:#e6db74">&#39;4&#39;</span>, <span style="color:#e6db74">&#39;0&#39;</span>, <span style="color:#e6db74">&#39;0&#39;</span>);
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> play_fav <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;170&#39;</span>, <span style="color:#e6db74">&#39;5&#39;</span>, <span style="color:#e6db74">&#39;0&#39;</span>, <span style="color:#e6db74">&#39;0&#39;</span>);

<span style="color:#75715e">-- ----------------------------
</span><span style="color:#75715e">-- Table structure for `play_list`
</span><span style="color:#75715e">-- ----------------------------
</span><span style="color:#75715e"></span><span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">EXISTS</span> <span style="color:#f92672">`</span>play_list<span style="color:#f92672">`</span>;
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#f92672">`</span>play_list<span style="color:#f92672">`</span> (
  <span style="color:#f92672">`</span>id<span style="color:#f92672">`</span> bigint(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;主键&#39;</span>,
  <span style="color:#f92672">`</span>play_name<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">255</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;歌单名字&#39;</span>,
  <span style="color:#f92672">`</span>userid<span style="color:#f92672">`</span> bigint(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;歌单作者账号id&#39;</span>,
  <span style="color:#f92672">`</span>createtime<span style="color:#f92672">`</span> bigint(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;0&#39;</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;歌单创建时间&#39;</span>,
  <span style="color:#f92672">`</span>updatetime<span style="color:#f92672">`</span> bigint(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;0&#39;</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;歌单更新时间&#39;</span>,
  <span style="color:#f92672">`</span>bookedcount<span style="color:#f92672">`</span> bigint(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;0&#39;</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;歌单订阅人数&#39;</span>,
  <span style="color:#f92672">`</span>trackcount<span style="color:#f92672">`</span> int(<span style="color:#ae81ff">11</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;0&#39;</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;歌曲的数量&#39;</span>,
  <span style="color:#f92672">`</span>status<span style="color:#f92672">`</span> int(<span style="color:#ae81ff">11</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;0&#39;</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;状态,是否删除&#39;</span>,
  <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span> (<span style="color:#f92672">`</span>id<span style="color:#f92672">`</span>),
  <span style="color:#66d9ef">KEY</span> <span style="color:#f92672">`</span>IDX_CreateTime<span style="color:#f92672">`</span> (<span style="color:#f92672">`</span>createtime<span style="color:#f92672">`</span>),
  <span style="color:#66d9ef">KEY</span> <span style="color:#f92672">`</span>IDX_UID_CTIME<span style="color:#f92672">`</span> (<span style="color:#f92672">`</span>userid<span style="color:#f92672">`</span>,<span style="color:#f92672">`</span>createtime<span style="color:#f92672">`</span>)
) ENGINE<span style="color:#f92672">=</span>InnoDB <span style="color:#66d9ef">DEFAULT</span> CHARSET<span style="color:#f92672">=</span>utf8 <span style="color:#66d9ef">COMMENT</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;歌单&#39;</span>;

<span style="color:#75715e">-- ----------------------------
</span><span style="color:#75715e">-- Records of play_list
</span><span style="color:#75715e">-- ----------------------------
</span><span style="color:#75715e"></span><span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> play_list <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;1&#39;</span>, <span style="color:#e6db74">&#39;老男孩&#39;</span>, <span style="color:#e6db74">&#39;1&#39;</span>, <span style="color:#e6db74">&#39;1430223383&#39;</span>, <span style="color:#e6db74">&#39;1430223383&#39;</span>, <span style="color:#e6db74">&#39;5&#39;</span>, <span style="color:#e6db74">&#39;6&#39;</span>, <span style="color:#e6db74">&#39;0&#39;</span>);
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> play_list <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;2&#39;</span>, <span style="color:#e6db74">&#39;情歌王子&#39;</span>, <span style="color:#e6db74">&#39;3&#39;</span>, <span style="color:#e6db74">&#39;1430223384&#39;</span>, <span style="color:#e6db74">&#39;1430223384&#39;</span>, <span style="color:#e6db74">&#39;7&#39;</span>, <span style="color:#e6db74">&#39;3&#39;</span>, <span style="color:#e6db74">&#39;0&#39;</span>);
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> play_list <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;3&#39;</span>, <span style="color:#e6db74">&#39;每日歌曲推荐&#39;</span>, <span style="color:#e6db74">&#39;5&#39;</span>, <span style="color:#e6db74">&#39;1430223385&#39;</span>, <span style="color:#e6db74">&#39;1430223385&#39;</span>, <span style="color:#e6db74">&#39;2&#39;</span>, <span style="color:#e6db74">&#39;4&#39;</span>, <span style="color:#e6db74">&#39;0&#39;</span>);
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> play_list <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;4&#39;</span>, <span style="color:#e6db74">&#39;山河水&#39;</span>, <span style="color:#e6db74">&#39;2&#39;</span>, <span style="color:#e6db74">&#39;1430223386&#39;</span>, <span style="color:#e6db74">&#39;1430223386&#39;</span>, <span style="color:#e6db74">&#39;5&#39;</span>, <span style="color:#66d9ef">null</span>, <span style="color:#e6db74">&#39;0&#39;</span>);
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> play_list <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;5&#39;</span>, <span style="color:#e6db74">&#39;李荣浩&#39;</span>, <span style="color:#e6db74">&#39;1&#39;</span>, <span style="color:#e6db74">&#39;1430223387&#39;</span>, <span style="color:#e6db74">&#39;1430223387&#39;</span>, <span style="color:#e6db74">&#39;1&#39;</span>, <span style="color:#e6db74">&#39;10&#39;</span>, <span style="color:#e6db74">&#39;0&#39;</span>);
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> play_list <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;6&#39;</span>, <span style="color:#e6db74">&#39;情深深&#39;</span>, <span style="color:#e6db74">&#39;5&#39;</span>, <span style="color:#e6db74">&#39;1430223388&#39;</span>, <span style="color:#e6db74">&#39;1430223389&#39;</span>, <span style="color:#e6db74">&#39;0&#39;</span>, <span style="color:#e6db74">&#39;0&#39;</span>, <span style="color:#e6db74">&#39;1&#39;</span>);

<span style="color:#75715e">-- ----------------------------
</span><span style="color:#75715e">-- Table structure for `song_list`
</span><span style="color:#75715e">-- ----------------------------
</span><span style="color:#75715e"></span><span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">EXISTS</span> <span style="color:#f92672">`</span>song_list<span style="color:#f92672">`</span>;
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#f92672">`</span>song_list<span style="color:#f92672">`</span> (
  <span style="color:#f92672">`</span>id<span style="color:#f92672">`</span> bigint(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;主键&#39;</span>,
  <span style="color:#f92672">`</span>song_name<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">255</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;歌曲名&#39;</span>,
  <span style="color:#f92672">`</span>artist<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">255</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;艺术节&#39;</span>,
  <span style="color:#f92672">`</span>createtime<span style="color:#f92672">`</span> bigint(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;0&#39;</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;歌曲创建时间&#39;</span>,
  <span style="color:#f92672">`</span>updatetime<span style="color:#f92672">`</span> bigint(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;0&#39;</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;歌曲更新时间&#39;</span>,
  <span style="color:#f92672">`</span>album<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">255</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;专辑&#39;</span>,
  <span style="color:#f92672">`</span>playcount<span style="color:#f92672">`</span> int(<span style="color:#ae81ff">11</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;0&#39;</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;点播次数&#39;</span>,
  <span style="color:#f92672">`</span>status<span style="color:#f92672">`</span> int(<span style="color:#ae81ff">11</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;0&#39;</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;状态,是否删除&#39;</span>,
  <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span> (<span style="color:#f92672">`</span>id<span style="color:#f92672">`</span>),
  <span style="color:#66d9ef">KEY</span> <span style="color:#f92672">`</span>IDX_artist<span style="color:#f92672">`</span> (<span style="color:#f92672">`</span>artist<span style="color:#f92672">`</span>),
  <span style="color:#66d9ef">KEY</span> <span style="color:#f92672">`</span>IDX_album<span style="color:#f92672">`</span> (<span style="color:#f92672">`</span>album<span style="color:#f92672">`</span>)
) ENGINE<span style="color:#f92672">=</span>InnoDB <span style="color:#66d9ef">DEFAULT</span> CHARSET<span style="color:#f92672">=</span>utf8 <span style="color:#66d9ef">COMMENT</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;歌曲列表&#39;</span>;

<span style="color:#75715e">-- ----------------------------
</span><span style="color:#75715e">-- Records of song_list
</span><span style="color:#75715e">-- ----------------------------
</span><span style="color:#75715e"></span><span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> song_list <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;1&#39;</span>, <span style="color:#e6db74">&#39;Good Lovin\&#39;</span> Gone Bad<span style="color:#e6db74">&#39;, &#39;</span>Bad Company<span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">0</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">0</span><span style="color:#e6db74">&#39;, &#39;</span>Straight Shooter<span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">453</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">0</span><span style="color:#e6db74">&#39;);
</span><span style="color:#e6db74">INSERT INTO song_list VALUES (&#39;</span><span style="color:#ae81ff">2</span><span style="color:#e6db74">&#39;, &#39;</span>Weep <span style="color:#66d9ef">No</span> <span style="color:#66d9ef">More</span><span style="color:#e6db74">&#39;, &#39;</span>Bad Company<span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">0</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">0</span><span style="color:#e6db74">&#39;, &#39;</span>Straight Shooter<span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">280</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">0</span><span style="color:#e6db74">&#39;);
</span><span style="color:#e6db74">INSERT INTO song_list VALUES (&#39;</span><span style="color:#ae81ff">3</span><span style="color:#e6db74">&#39;, &#39;</span>Shooting Star<span style="color:#e6db74">&#39;, &#39;</span>Bad Company<span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">0</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">0</span><span style="color:#e6db74">&#39;, &#39;</span>Straight Shooter<span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">530</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">0</span><span style="color:#e6db74">&#39;);
</span><span style="color:#e6db74">INSERT INTO song_list VALUES (&#39;</span><span style="color:#ae81ff">4</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#960050;background-color:#1e0010">大象</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#960050;background-color:#1e0010">李志</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">0</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">0</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">1701</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">560</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">0</span><span style="color:#e6db74">&#39;);
</span><span style="color:#e6db74">INSERT INTO song_list VALUES (&#39;</span><span style="color:#ae81ff">5</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#960050;background-color:#1e0010">定西</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#960050;background-color:#1e0010">李志</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">0</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">0</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">1701</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">1023</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">0</span><span style="color:#e6db74">&#39;);
</span><span style="color:#e6db74">INSERT INTO song_list VALUES (&#39;</span><span style="color:#ae81ff">6</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#960050;background-color:#1e0010">红雪莲</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#960050;background-color:#1e0010">洪启</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">0</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">0</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#960050;background-color:#1e0010">红雪莲</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">220</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">0</span><span style="color:#e6db74">&#39;);
</span><span style="color:#e6db74">INSERT INTO song_list VALUES (&#39;</span><span style="color:#ae81ff">7</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#960050;background-color:#1e0010">风柜来的人</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#960050;background-color:#1e0010">李宗盛</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">0</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">0</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#960050;background-color:#1e0010">作品李宗盛</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">566</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">0</span><span style="color:#e6db74">&#39;);
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">-- ----------------------------
</span><span style="color:#e6db74">-- Table structure for `stu`
</span><span style="color:#e6db74">-- ----------------------------
</span><span style="color:#e6db74">DROP TABLE IF EXISTS `stu`;
</span><span style="color:#e6db74">CREATE TABLE `stu` (
</span><span style="color:#e6db74">  `id` int(10) NOT NULL DEFAULT &#39;</span><span style="color:#ae81ff">0</span><span style="color:#e6db74">&#39;,
</span><span style="color:#e6db74">  `name` varchar(20) DEFAULT NULL,
</span><span style="color:#e6db74">  `age` int(10) DEFAULT NULL,
</span><span style="color:#e6db74">  PRIMARY KEY (`id`)
</span><span style="color:#e6db74">) ENGINE=InnoDB DEFAULT CHARSET=latin1;
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">-- ----------------------------
</span><span style="color:#e6db74">-- Records of stu
</span><span style="color:#e6db74">-- ----------------------------
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">-- ----------------------------
</span><span style="color:#e6db74">-- Table structure for `tbl_proc_test`
</span><span style="color:#e6db74">-- ----------------------------
</span><span style="color:#e6db74">DROP TABLE IF EXISTS `tbl_proc_test`;
</span><span style="color:#e6db74">CREATE TABLE `tbl_proc_test` (
</span><span style="color:#e6db74">  `id` int(11) NOT NULL AUTO_INCREMENT,
</span><span style="color:#e6db74">  `num` int(11) DEFAULT NULL,
</span><span style="color:#e6db74">  PRIMARY KEY (`id`)
</span><span style="color:#e6db74">) ENGINE=InnoDB AUTO_INCREMENT=30 DEFAULT CHARSET=utf8;
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">-- ----------------------------
</span><span style="color:#e6db74">-- Records of tbl_proc_test
</span><span style="color:#e6db74">-- ----------------------------
</span><span style="color:#e6db74">INSERT INTO tbl_proc_test VALUES (&#39;</span><span style="color:#ae81ff">11</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">1</span><span style="color:#e6db74">&#39;);
</span><span style="color:#e6db74">INSERT INTO tbl_proc_test VALUES (&#39;</span><span style="color:#ae81ff">12</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">2</span><span style="color:#e6db74">&#39;);
</span><span style="color:#e6db74">INSERT INTO tbl_proc_test VALUES (&#39;</span><span style="color:#ae81ff">13</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">6</span><span style="color:#e6db74">&#39;);
</span><span style="color:#e6db74">INSERT INTO tbl_proc_test VALUES (&#39;</span><span style="color:#ae81ff">14</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">24</span><span style="color:#e6db74">&#39;);
</span><span style="color:#e6db74">INSERT INTO tbl_proc_test VALUES (&#39;</span><span style="color:#ae81ff">15</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">120</span><span style="color:#e6db74">&#39;);
</span><span style="color:#e6db74">INSERT INTO tbl_proc_test VALUES (&#39;</span><span style="color:#ae81ff">16</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">720</span><span style="color:#e6db74">&#39;);
</span><span style="color:#e6db74">INSERT INTO tbl_proc_test VALUES (&#39;</span><span style="color:#ae81ff">17</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">5040</span><span style="color:#e6db74">&#39;);
</span><span style="color:#e6db74">INSERT INTO tbl_proc_test VALUES (&#39;</span><span style="color:#ae81ff">18</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">40320</span><span style="color:#e6db74">&#39;);
</span><span style="color:#e6db74">INSERT INTO tbl_proc_test VALUES (&#39;</span><span style="color:#ae81ff">19</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">362880</span><span style="color:#e6db74">&#39;);
</span><span style="color:#e6db74">INSERT INTO tbl_proc_test VALUES (&#39;</span><span style="color:#ae81ff">20</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">3628800</span><span style="color:#e6db74">&#39;);
</span><span style="color:#e6db74">INSERT INTO tbl_proc_test VALUES (&#39;</span><span style="color:#ae81ff">21</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">1</span><span style="color:#e6db74">&#39;);
</span><span style="color:#e6db74">INSERT INTO tbl_proc_test VALUES (&#39;</span><span style="color:#ae81ff">22</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">2</span><span style="color:#e6db74">&#39;);
</span><span style="color:#e6db74">INSERT INTO tbl_proc_test VALUES (&#39;</span><span style="color:#ae81ff">23</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">6</span><span style="color:#e6db74">&#39;);
</span><span style="color:#e6db74">INSERT INTO tbl_proc_test VALUES (&#39;</span><span style="color:#ae81ff">24</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">24</span><span style="color:#e6db74">&#39;);
</span><span style="color:#e6db74">INSERT INTO tbl_proc_test VALUES (&#39;</span><span style="color:#ae81ff">25</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">1</span><span style="color:#e6db74">&#39;);
</span><span style="color:#e6db74">INSERT INTO tbl_proc_test VALUES (&#39;</span><span style="color:#ae81ff">26</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">2</span><span style="color:#e6db74">&#39;);
</span><span style="color:#e6db74">INSERT INTO tbl_proc_test VALUES (&#39;</span><span style="color:#ae81ff">27</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">6</span><span style="color:#e6db74">&#39;);
</span><span style="color:#e6db74">INSERT INTO tbl_proc_test VALUES (&#39;</span><span style="color:#ae81ff">28</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">24</span><span style="color:#e6db74">&#39;);
</span><span style="color:#e6db74">INSERT INTO tbl_proc_test VALUES (&#39;</span><span style="color:#ae81ff">29</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">120</span><span style="color:#e6db74">&#39;);
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">-- ----------------------------
</span><span style="color:#e6db74">-- Table structure for `tbl_test1`
</span><span style="color:#e6db74">-- ----------------------------
</span><span style="color:#e6db74">DROP TABLE IF EXISTS `tbl_test1`;
</span><span style="color:#e6db74">CREATE TABLE `tbl_test1` (
</span><span style="color:#e6db74">  `user` varchar(255) NOT NULL COMMENT &#39;</span><span style="color:#960050;background-color:#1e0010">主键</span><span style="color:#e6db74">&#39;,
</span><span style="color:#e6db74">  `key` varchar(255) NOT NULL,
</span><span style="color:#e6db74">  `value` varchar(255) NOT NULL,
</span><span style="color:#e6db74">  PRIMARY KEY (`user`,`key`)
</span><span style="color:#e6db74">) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT=&#39;</span><span style="color:#960050;background-color:#1e0010">行列转换测试</span><span style="color:#e6db74">&#39;;
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">-- ----------------------------
</span><span style="color:#e6db74">-- Records of tbl_test1
</span><span style="color:#e6db74">-- ----------------------------
</span><span style="color:#e6db74">INSERT INTO tbl_test1 VALUES (&#39;</span>li<span style="color:#e6db74">&#39;, &#39;</span>age<span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">18</span><span style="color:#e6db74">&#39;);
</span><span style="color:#e6db74">INSERT INTO tbl_test1 VALUES (&#39;</span>li<span style="color:#e6db74">&#39;, &#39;</span>dep<span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">2</span><span style="color:#e6db74">&#39;);
</span><span style="color:#e6db74">INSERT INTO tbl_test1 VALUES (&#39;</span>li<span style="color:#e6db74">&#39;, &#39;</span>sex<span style="color:#e6db74">&#39;, &#39;</span>male<span style="color:#e6db74">&#39;);
</span><span style="color:#e6db74">INSERT INTO tbl_test1 VALUES (&#39;</span>sun<span style="color:#e6db74">&#39;, &#39;</span>age<span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">44</span><span style="color:#e6db74">&#39;);
</span><span style="color:#e6db74">INSERT INTO tbl_test1 VALUES (&#39;</span>sun<span style="color:#e6db74">&#39;, &#39;</span>dep<span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">3</span><span style="color:#e6db74">&#39;);
</span><span style="color:#e6db74">INSERT INTO tbl_test1 VALUES (&#39;</span>sun<span style="color:#e6db74">&#39;, &#39;</span>sex<span style="color:#e6db74">&#39;, &#39;</span>female<span style="color:#e6db74">&#39;);
</span><span style="color:#e6db74">INSERT INTO tbl_test1 VALUES (&#39;</span>wang<span style="color:#e6db74">&#39;, &#39;</span>age<span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">20</span><span style="color:#e6db74">&#39;);
</span><span style="color:#e6db74">INSERT INTO tbl_test1 VALUES (&#39;</span>wang<span style="color:#e6db74">&#39;, &#39;</span>dep<span style="color:#e6db74">&#39;, &#39;</span><span style="color:#ae81ff">3</span><span style="color:#e6db74">&#39;);
</span><span style="color:#e6db74">INSERT INTO tbl_test1 VALUES (&#39;</span>wang<span style="color:#e6db74">&#39;, &#39;</span>sex<span style="color:#e6db74">&#39;, &#39;</span>male<span style="color:#e6db74">&#39;);
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">-- ----------------------------
</span><span style="color:#e6db74">-- Procedure structure for `proc_test1`
</span><span style="color:#e6db74">-- ----------------------------
</span><span style="color:#e6db74">DROP PROCEDURE IF EXISTS `proc_test1`;
</span><span style="color:#e6db74">DELIMITER ;;
</span><span style="color:#e6db74">CREATE DEFINER=`root` PROCEDURE `proc_test1`(IN total INT,OUT res INT)
</span><span style="color:#e6db74">BEGIN   
</span><span style="color:#e6db74">    DECLARE i INT;  
</span><span style="color:#e6db74">    SET i = 1;
</span><span style="color:#e6db74">    SET res = 1;
</span><span style="color:#e6db74">    IF total &lt;= 0 THEN   
</span><span style="color:#e6db74">        SET total = 1;   
</span><span style="color:#e6db74">    END IF;   
</span><span style="color:#e6db74">    WHILE i &lt;= total DO
</span><span style="color:#e6db74">        SET res = res * i;
</span><span style="color:#e6db74">        INSERT INTO tbl_proc_test(num) VALUES (res);  
</span><span style="color:#e6db74">        SET i = i + 1;
</span><span style="color:#e6db74">    END WHILE;
</span><span style="color:#e6db74">END
</span><span style="color:#e6db74">;;
</span><span style="color:#e6db74">DELIMITER ;
</span></code></pre></div><h3 id="说明">说明</h3>
<ul>
<li>本课程介绍以MySQL SQL语法为基础，不同数据库SQL语法存在差异，并未完全遵照ANSI标准。</li>
<li>本课程结合一个实际项目（云音乐），介绍各种SQL语言在实际应用中如何实现业务功能。</li>
</ul>
<h3 id="sql进阶语法order-by">SQL进阶语法——order by</h3>
<p>场景1：歌单按时间排序</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#75715e">-- 查看全部歌单
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> play_list;

<span style="color:#75715e">-- 按创建时间排序
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> play_list <span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> createtime;
<span style="color:#75715e">-- MySQL默认升序，如果按降序排列，则使用如下语句。
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> play_list <span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> createtime <span style="color:#66d9ef">desc</span>;
<span style="color:#75715e">-- 也可以按照多个字段来排序
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> play_list <span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> bookedcount, trackcount;
</code></pre></div><h3 id="sql进阶语法distinct">SQL进阶语法——distinct</h3>
<p>场景2：统计云音乐创建歌单的用户</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#75715e">-- 有重复
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> userid <span style="color:#66d9ef">from</span> play_list;

<span style="color:#75715e">-- 去重
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#66d9ef">distinct</span> userid <span style="color:#66d9ef">from</span> play_list;

<span style="color:#75715e">-- 多个字段
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#66d9ef">distinct</span> userid, play_name <span style="color:#66d9ef">from</span> play_list;
</code></pre></div><ul>
<li>distinct用于返回唯一不同的值</li>
<li>可以返回多列的唯一组合</li>
<li>底层实现使用排序，如果数据量大会消耗较多的IO和CPU</li>
</ul>
<h3 id="sql进阶语法group-by">SQL进阶语法——group by</h3>
<p>场景3-1：统计云音乐创建歌单的用户列表和每人创建歌单的数量。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#75715e">-- 每个用户歌单的最大订阅数
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> userid, <span style="color:#66d9ef">max</span>(bookedcount) <span style="color:#66d9ef">from</span> play_list <span style="color:#66d9ef">group</span> <span style="color:#66d9ef">by</span> userid;

<span style="color:#75715e">-- 每个用户歌单的数量
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> userid, <span style="color:#66d9ef">count</span>(<span style="color:#f92672">*</span>) <span style="color:#66d9ef">from</span> play_list <span style="color:#66d9ef">group</span> <span style="color:#66d9ef">by</span> userid;
</code></pre></div><ul>
<li>group by 根据单列或多列对数据进行分组，通常结合聚合函数使用，如count(*).</li>
</ul>
<h3 id="sql进阶语法group-by-having">SQL进阶语法——group by having</h3>
<p>场景3-2：统计云音乐创建歌单的用户列表和每人创建歌单的数量，并且只显示歌单数量排序大于等于2的用户</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> userid, <span style="color:#66d9ef">count</span>(<span style="color:#f92672">*</span>) <span style="color:#66d9ef">from</span> play_list <span style="color:#66d9ef">group</span> <span style="color:#66d9ef">by</span> userid <span style="color:#66d9ef">having</span> <span style="color:#66d9ef">count</span>(<span style="color:#f92672">*</span>) <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">2</span>;
</code></pre></div><ul>
<li>having 是对结果进行过滤</li>
</ul>
<p>SQL进阶语法-like</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> play_list <span style="color:#66d9ef">where</span> play_name <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;%男孩%&#39;</span>;
</code></pre></div><table>
<thead>
<tr>
<th style="text-align:left">通配符</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">%</td>
<td style="text-align:left">代替一个或多个字符</td>
</tr>
<tr>
<td style="text-align:left">_</td>
<td style="text-align:left">代替单个字符</td>
</tr>
<tr>
<td style="text-align:left">[charlist]</td>
<td style="text-align:left">中括号中的任何一个字符</td>
</tr>
<tr>
<td style="text-align:left">[^charlist] 或者 [!charlist]</td>
<td style="text-align:left">不在中括号中的任何单一字符</td>
</tr>
</tbody>
</table>
<ul>
<li>除了百分号在最右面的情况以外，他会对这个表中所有的记录进行一次查询匹配，而没办法使用索引，效率较低。大表中需要慎用like。可以使用全文检索的手段。</li>
</ul>
<h3 id="sql进阶语法-limit-offset">SQL进阶语法-limit, offset</h3>
<p>场景4：查询一个月内创建歌单（从第6行开始显示10条记录）</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> play_list <span style="color:#66d9ef">where</span> (createtime <span style="color:#66d9ef">between</span> <span style="color:#ae81ff">1427791323</span> <span style="color:#66d9ef">and</span> <span style="color:#ae81ff">1430383307</span>) <span style="color:#66d9ef">limit</span> <span style="color:#ae81ff">10</span> <span style="color:#66d9ef">offset</span> <span style="color:#ae81ff">6</span>;
</code></pre></div><ul>
<li>offset后的值不建议太大，需要消耗的IO较大</li>
</ul>
<h3 id="case-when">case when</h3>
<ul>
<li>case when 实现类似编程语言的if else功能，可以对SQL的输出结果进行选择判断。</li>
</ul>
<p>场景5：对于未录入歌曲的歌单(trackcount = null)，输出结果时歌曲数返回0.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">when</span> play_name, trackcount <span style="color:#66d9ef">is</span> <span style="color:#66d9ef">null</span> <span style="color:#66d9ef">then</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">else</span> trackcount <span style="color:#66d9ef">end</span> <span style="color:#66d9ef">from</span> play_list;
</code></pre></div><h3 id="select相关进阶语法">select相关进阶语法</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span>
  [<span style="color:#66d9ef">DISTINCT</span>]
  select_expr [, select_expr ...]
  [<span style="color:#66d9ef">FROM</span> table_references
  [<span style="color:#66d9ef">WHERE</span> where_condition]
  [<span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> <span style="color:#960050;background-color:#1e0010">{</span>col_name <span style="color:#f92672">|</span> expr <span style="color:#f92672">|</span> <span style="color:#66d9ef">position</span><span style="color:#960050;background-color:#1e0010">}</span>
    [<span style="color:#66d9ef">ASC</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">DESC</span>], ... [<span style="color:#66d9ef">WITH</span> <span style="color:#66d9ef">ROLLUP</span>]]
  [<span style="color:#66d9ef">HAVING</span> where_condition]
  [<span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> <span style="color:#960050;background-color:#1e0010">{</span>col_name <span style="color:#f92672">|</span> expr <span style="color:#f92672">|</span> <span style="color:#66d9ef">position</span><span style="color:#960050;background-color:#1e0010">}</span>
    [<span style="color:#66d9ef">ASC</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">DESC</span>], ...]
  [<span style="color:#66d9ef">LIMIT</span> <span style="color:#960050;background-color:#1e0010">{</span> [<span style="color:#66d9ef">offset</span>, ] <span style="color:#66d9ef">row_count</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">row_count</span> <span style="color:#66d9ef">OFFSET</span> <span style="color:#66d9ef">offset</span><span style="color:#960050;background-color:#1e0010">}</span>]
    [<span style="color:#66d9ef">FOR</span> <span style="color:#66d9ef">UPDATE</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">LOCK</span> <span style="color:#66d9ef">IN</span> <span style="color:#66d9ef">SHARE</span> <span style="color:#66d9ef">MODE</span>]]
</code></pre></div><h3 id="连接-join">连接-Join</h3>
<p>连接的作用是用一个SQL语句把多个表中相互关联的数据查出来</p>
<p>场景6：查询收藏“老男孩”歌单的用户列表</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> play_list, play_fav <span style="color:#66d9ef">where</span> play_list.id<span style="color:#f92672">=</span>play_fav.play_id;
<span style="color:#66d9ef">select</span> play_fav.userid <span style="color:#66d9ef">from</span> play_list, play_fav <span style="color:#66d9ef">where</span> play_list.id<span style="color:#f92672">=</span>play_fav.play_id <span style="color:#66d9ef">and</span> play_list.play_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;老男孩&#39;</span>;
<span style="color:#75715e">-- 另一种写法
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> f.userid <span style="color:#66d9ef">from</span> play_list lst <span style="color:#66d9ef">join</span> play_fav f <span style="color:#66d9ef">on</span> lst.id<span style="color:#f92672">=</span>f.play_id <span style="color:#66d9ef">where</span> lst.play_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;老男孩&#39;</span>;
</code></pre></div><h3 id="子查询">子查询</h3>
<ul>
<li>MySQL还有另一种写法，可以实现同样的功能。</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> userid <span style="color:#66d9ef">from</span> play_fav <span style="color:#66d9ef">where</span> play_id<span style="color:#f92672">=</span>(<span style="color:#66d9ef">select</span> id <span style="color:#66d9ef">from</span> play_list <span style="color:#66d9ef">where</span> play_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;老男孩&#39;</span>);
</code></pre></div><p>子查询：内层查询的结果作为外层的比较条件。一般子查询都可以转换成连接，推荐使用连接。</p>
<ul>
<li>不利于MySQL的查询优化器进行优化，可能存在性能问题</li>
<li>连接的实现是嵌套循环，选择一个驱动表，遍历驱动表，查询内层表，依次循环。驱动表会至少查询一边，如果有索引等，内层表可以非常快，查询优化器会选择数据小的表作为驱动表。</li>
<li>子查询由人为规定驱动表和内层表</li>
</ul>
<h3 id="连接--left-join">连接- left Join</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> lst.play_name <span style="color:#66d9ef">from</span> play_list lst <span style="color:#66d9ef">left</span> <span style="color:#66d9ef">join</span> play_fav f <span style="color:#66d9ef">on</span> lst.id <span style="color:#f92672">=</span> f.play_id <span style="color:#66d9ef">where</span> f.play_id <span style="color:#66d9ef">is</span> <span style="color:#66d9ef">null</span>;
</code></pre></div><ul>
<li>LEFT JOIN从左表(play_list)返回所有的行，即使在右表中(play_fav)中没有匹配的行。</li>
<li>与LEFT JOIN相对应的有RIGHT JOIN关键字，会从右表那里返回所有的行，即使在左表中没有匹配的行。</li>
</ul>
<p>场景7：查询出没有用户收藏的歌单</p>
<h3 id="sql进阶语法-union">SQL进阶语法-union</h3>
<p>场景8：老板想看创建和收藏歌单的所有用户，查询play_list和play_fav两表中所有的userid</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> userid <span style="color:#66d9ef">from</span> play_list <span style="color:#66d9ef">union</span> <span style="color:#66d9ef">select</span> userid <span style="color:#66d9ef">from</span> play_fav;
<span style="color:#75715e">-- 默认会去重， 不想去重的话使用union all代替union。
</span></code></pre></div><h3 id="dml进阶语法">DML进阶语法</h3>
<ul>
<li>多值插入： insert into table values(&hellip;.),(&hellip;.)
<ul>
<li>可以一次插入多行数据，减少与数据库的交互提高效率</li>
<li>eg： <code>insert into A values(4, 33), (5, 33);</code></li>
</ul>
</li>
<li>覆盖插入： replace into table values (&hellip;.)
<ul>
<li>可以简化业务逻辑的判断</li>
</ul>
</li>
<li>忽略插入： insert ignore into table value (&hellip;.)
<ul>
<li>可以简化业务逻辑的判断</li>
</ul>
</li>
<li>查询插入： insert into table_a select * from table_b
<ul>
<li>常用于导表操作</li>
</ul>
</li>
<li>insert主键重复则update
<ul>
<li><code>INSERT INTO TABLE tbl VALUES (id, col1, col2) ON DUPLICATE KEY UPDATE col2=....;</code></li>
<li>eg: <code>insert into A values(2, 40) on duplicate key update age=40;</code></li>
<li>可以简化前端业务逻辑的判断</li>
</ul>
</li>
<li>连表update
<ul>
<li>A表：id, age</li>
<li>B表：id, name, age</li>
<li>A表id与B表id关联，根据B表的age值更新A表的age。</li>
<li>eg: <code>update A,B set A.age=B.age where A.id=B.id;</code></li>
</ul>
</li>
<li>连表删除
<ul>
<li>A表：id, age</li>
<li>B表：id, name, age</li>
<li>A表id与B表id关联，根据B表的age值删除A表的数据。</li>
<li>eg: <code>delete A from A,B where A.id=B.id and B.name='pw';</code></li>
</ul>
</li>
</ul>
<h3 id="总结">总结</h3>
<ul>
<li>select查询进阶语法
<ul>
<li>order by/distinct/group by having (聚合函数) /like (%前缀后缀)</li>
</ul>
</li>
<li>连接语法
<ul>
<li>内连接、左连接、右连接、 Union [ALL]</li>
</ul>
</li>
<li>DML进阶语法
<ul>
<li>insert/连表update/连表delete</li>
</ul>
</li>
</ul>
<h2 id="25-内置函数">2.5-内置函数</h2>
<h3 id="聚合函数">聚合函数</h3>
<ul>
<li>聚合函数面向一组数据，对数据进行聚合运算后返回单一的值。</li>
<li>MySQL聚合函数的基本语法：<code>SELECT function(列) from 表</code></li>
<li>常用聚合函数：</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">函数</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">AVG()</td>
<td style="text-align:left">返回列的平均值</td>
</tr>
<tr>
<td style="text-align:left">COUNT(DISTINCT)</td>
<td style="text-align:left">返回列去重后的行数</td>
</tr>
<tr>
<td style="text-align:left">COUNT()</td>
<td style="text-align:left">返回列的行数</td>
</tr>
<tr>
<td style="text-align:left">MAX()</td>
<td style="text-align:left">返回列的最大值</td>
</tr>
<tr>
<td style="text-align:left">MIN()</td>
<td style="text-align:left">返回列的最小值</td>
</tr>
<tr>
<td style="text-align:left">SUM()</td>
<td style="text-align:left">返回列的总和</td>
</tr>
<tr>
<td style="text-align:left">GROUP_CONCAT()</td>
<td style="text-align:left">返回一组值的连接字符串(MySQL独有)</td>
</tr>
</tbody>
</table>
<p><em>实例还是上节中的那些表</em></p>
<p>场景1：查询每张专辑总的点播次数和每首歌的平均点播次数。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> album, <span style="color:#66d9ef">sum</span>(playcount), <span style="color:#66d9ef">avg</span>(playcount) <span style="color:#66d9ef">from</span> song_list <span style="color:#66d9ef">group</span> <span style="color:#66d9ef">by</span> album;
</code></pre></div><p>场景2：查询全部歌曲中的最大的播放次数和最小的播放次数。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> <span style="color:#66d9ef">max</span>(playcount), <span style="color:#66d9ef">min</span>(playcount) <span style="color:#66d9ef">from</span> song_list;
</code></pre></div><p>场景2续：查询播放次数最多的歌曲</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#75715e">-- 错误查法
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> song_name, <span style="color:#66d9ef">max</span>(playcount) <span style="color:#66d9ef">from</span> song_list;
<span style="color:#75715e">-- 正确查法
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> song_name, playcount <span style="color:#66d9ef">from</span> song_list <span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> playcount <span style="color:#66d9ef">desc</span> <span style="color:#66d9ef">limit</span> <span style="color:#ae81ff">1</span>;
</code></pre></div><ul>
<li><code>select count(*) from song_list;</code></li>
<li><code>select count(1) from song_list;</code></li>
<li><code>select count(song_name) from song_list;</code></li>
</ul>
<p><code>count(*)</code>和<code>count(1)</code>基本一样，没有明显的性能差异。
<code>count(*)</code>和<code>count(song_name)</code>差别在于<code>count(song_name)</code>会除去song_name is null的情况</p>
<p>场景3：显示每张专辑的歌曲列表</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> album, GROUP_CONCAT(song_name) <span style="color:#66d9ef">from</span> song_list <span style="color:#66d9ef">group</span> <span style="color:#66d9ef">by</span> album;
<span style="color:#75715e">-- 默认最大只能连接1024个字符，但是可以通过改数据库参数来改变。
</span></code></pre></div><h3 id="使用聚合函数做数据库行列转换">使用聚合函数做数据库行列转换</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> <span style="color:#66d9ef">user</span>,
<span style="color:#66d9ef">max</span>(<span style="color:#66d9ef">case</span> <span style="color:#66d9ef">when</span> <span style="color:#e6db74">&#39;key&#39;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;age&#39;</span> <span style="color:#66d9ef">then</span> value <span style="color:#66d9ef">end</span>) age,
<span style="color:#66d9ef">max</span>(<span style="color:#66d9ef">case</span> <span style="color:#66d9ef">when</span> <span style="color:#e6db74">&#39;key&#39;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;sex&#39;</span> <span style="color:#66d9ef">then</span> value <span style="color:#66d9ef">end</span>) sex,
<span style="color:#66d9ef">max</span>(<span style="color:#66d9ef">case</span> <span style="color:#66d9ef">when</span> <span style="color:#e6db74">&#39;key&#39;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;dep&#39;</span> <span style="color:#66d9ef">then</span> value <span style="color:#66d9ef">end</span>) dep,
<span style="color:#66d9ef">from</span> tbl_test1
<span style="color:#66d9ef">group</span> <span style="color:#66d9ef">by</span> <span style="color:#66d9ef">user</span>;
</code></pre></div><h3 id="预定义函数">预定义函数</h3>
<ul>
<li>预定义函数面向单值数据，返回一对一的处理结果(聚合函数可以理解成多对一)。</li>
<li>预定义函数基本语法：
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> <span style="color:#66d9ef">function</span>(<span style="color:#960050;background-color:#1e0010">列</span>) <span style="color:#66d9ef">from</span> <span style="color:#960050;background-color:#1e0010">表</span>;
<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> <span style="color:#960050;background-color:#1e0010">表</span> <span style="color:#66d9ef">where</span> <span style="color:#960050;background-color:#1e0010">列</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>(value) ...
</code></pre></div></li>
</ul>
<h3 id="预定义函数-字符串函数">预定义函数-字符串函数</h3>
<table>
<thead>
<tr>
<th style="text-align:left">函数</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">LENGTH()</td>
<td style="text-align:left">返回列的字节数</td>
</tr>
<tr>
<td style="text-align:left">CHAR_LENGTH()</td>
<td style="text-align:left">返回列的字符数</td>
</tr>
<tr>
<td style="text-align:left">TRIM()/RTRIM()/LTRIM()</td>
<td style="text-align:left">去除两边空格/去除右边空格/去除左边空格</td>
</tr>
<tr>
<td style="text-align:left">SUBSTRING(str, pos, [len])</td>
<td style="text-align:left">从pos位置截取字符串str，截取len长度</td>
</tr>
<tr>
<td style="text-align:left">LOCATE(substr, str, [pos])</td>
<td style="text-align:left">返回substr在str字符串中的位置</td>
</tr>
<tr>
<td style="text-align:left">REPLACE(str, from_str, to_str)</td>
<td style="text-align:left">将str字符串中的from_str替换成to_str</td>
</tr>
<tr>
<td style="text-align:left">LOWER(), UPPER()</td>
<td style="text-align:left">字符串转换为小写/大写</td>
</tr>
</tbody>
</table>
<ul>
<li>字符串函数 - 实例</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">SUBSTRING</span>(<span style="color:#e6db74">&#39;abcdef&#39;</span>, <span style="color:#ae81ff">3</span>);
<span style="color:#75715e">-- &#39;cdef&#39;
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">SUBSTRING</span>(<span style="color:#e6db74">&#39;abcdef&#39;</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>);
<span style="color:#75715e">-- &#39;def&#39;
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">SUBSTRING</span>(<span style="color:#e6db74">&#39;abcdef&#39;</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">2</span>);
<span style="color:#75715e">-- &#39;cd&#39;
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> LOCATE(<span style="color:#e6db74">&#39;bar&#39;</span>, <span style="color:#e6db74">&#39;foobarbar&#39;</span>);
<span style="color:#75715e">-- 4
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> LOCATE(<span style="color:#e6db74">&#39;xbar&#39;</span>, <span style="color:#e6db74">&#39;foobar&#39;</span>);
<span style="color:#75715e">-- 0
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> LOCATE(<span style="color:#e6db74">&#39;bar&#39;</span>, <span style="color:#e6db74">&#39;foobarbar&#39;</span>, <span style="color:#ae81ff">5</span>);
<span style="color:#75715e">-- 7
</span></code></pre></div><h3 id="预定义函数-时间处理函数">预定义函数-时间处理函数</h3>
<table>
<thead>
<tr>
<th style="text-align:left">函数</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">CURDATE()</td>
<td style="text-align:left">当前日期</td>
</tr>
<tr>
<td style="text-align:left">CURTIME()</td>
<td style="text-align:left">当前时间</td>
</tr>
<tr>
<td style="text-align:left">NOW()</td>
<td style="text-align:left">显示当前时间日期(常用)</td>
</tr>
<tr>
<td style="text-align:left">UNIX_TIMESTAMP()</td>
<td style="text-align:left">当前时间戳</td>
</tr>
<tr>
<td style="text-align:left">DATE_FORMAT(date, format)</td>
<td style="text-align:left">按指定格式显示时间</td>
</tr>
<tr>
<td style="text-align:left">DATE_ADD(date, INTERVAL unit)</td>
<td style="text-align:left">计算指定日期向后加一段时间的日期</td>
</tr>
<tr>
<td style="text-align:left">DATE_SUB(date, INTERVAL unit)</td>
<td style="text-align:left">计算指定日期向前减一段时间的日期</td>
</tr>
</tbody>
</table>
<ul>
<li>实例：</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> NOW() <span style="color:#f92672">+</span> INTERVAL <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">MONTH</span>;
<span style="color:#66d9ef">SELECT</span> NOW() <span style="color:#f92672">-</span> INTERVAL <span style="color:#ae81ff">1</span> WEEK;
</code></pre></div><h3 id="预定义函数-数字处理函数">预定义函数-数字处理函数</h3>
<table>
<thead>
<tr>
<th style="text-align:left">函数</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">ABS()</td>
<td style="text-align:left">返回数值的绝对值</td>
</tr>
<tr>
<td style="text-align:left">CEIL()</td>
<td style="text-align:left">对小数向上取整 CEIL(1.2)=2</td>
</tr>
<tr>
<td style="text-align:left">ROUND()</td>
<td style="text-align:left">四舍五入</td>
</tr>
<tr>
<td style="text-align:left">POW(num, n)</td>
<td style="text-align:left">num的n次幂 POW(2, 2)=4</td>
</tr>
<tr>
<td style="text-align:left">FLOOR()</td>
<td style="text-align:left">对小数向下取整 CELL(1.2)=1</td>
</tr>
<tr>
<td style="text-align:left">MOD(N, M)</td>
<td style="text-align:left">取模(返回n除以m的余数)=N % M</td>
</tr>
<tr>
<td style="text-align:left">RAND()</td>
<td style="text-align:left">取0~1之间的一个随机数</td>
</tr>
</tbody>
</table>
<h3 id="算数逻辑运算">算数、逻辑运算</h3>
<ul>
<li>比较运算</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">函数</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">IS, IS NOT</td>
<td style="text-align:left">判定布尔值 IS True, IS NOT False, IS NULL</td>
</tr>
<tr>
<td style="text-align:left">&gt;, &gt;=</td>
<td style="text-align:left">大于，大于等于</td>
</tr>
<tr>
<td style="text-align:left">&lt;, &lt;=</td>
<td style="text-align:left">小于，小于等于</td>
</tr>
<tr>
<td style="text-align:left">=</td>
<td style="text-align:left">等于</td>
</tr>
<tr>
<td style="text-align:left">!=, &lt;&gt;</td>
<td style="text-align:left">不等于</td>
</tr>
<tr>
<td style="text-align:left">BETWEEN M AND N</td>
<td style="text-align:left">取M和N之间的值</td>
</tr>
<tr>
<td style="text-align:left">IN, NOT IN</td>
<td style="text-align:left">检查是否在或不在一组值之中</td>
</tr>
</tbody>
</table>
<p>实例：查询一个月内userid为1,3,5的用户创建的歌单</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> play_list <span style="color:#66d9ef">where</span> (createtime <span style="color:#66d9ef">between</span> <span style="color:#ae81ff">1427791323</span> <span style="color:#66d9ef">and</span> <span style="color:#ae81ff">1430383307</span>) <span style="color:#66d9ef">and</span> userid <span style="color:#66d9ef">in</span> (<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">5</span>);
</code></pre></div><ul>
<li><code>*,/,DIV,%,MOD,-,+</code></li>
<li><code>NOT, AND, &amp;&amp;, XOR, OR, ||</code></li>
</ul>
<h2 id="26-触发器与存储过程">2.6-触发器与存储过程</h2>
<h3 id="触发器">触发器</h3>
<ul>
<li>是什么
<ul>
<li>触发器是加在表上的一个特殊程序，当表上出现特定的事件(INSERT/UPDATE/DELETE)时触发该程序执行。</li>
</ul>
</li>
<li>做什么
<ul>
<li>数据订正；迁移表；实现特定的业务逻辑。</li>
</ul>
</li>
</ul>
<h3 id="触发器-基本语法">触发器-基本语法</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span>
[<span style="color:#66d9ef">DEFINER</span> <span style="color:#f92672">=</span> <span style="color:#960050;background-color:#1e0010">{</span> <span style="color:#66d9ef">user</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">CURRENT_USER</span> <span style="color:#960050;background-color:#1e0010">}</span>]
<span style="color:#66d9ef">TRIGGER</span> <span style="color:#66d9ef">trigger_name</span> trigger_time
trigger_event <span style="color:#66d9ef">ON</span> tbl_name
<span style="color:#66d9ef">FOR</span> <span style="color:#66d9ef">EACH</span> <span style="color:#66d9ef">ROW</span>
trigger_body t

trigger_time: <span style="color:#960050;background-color:#1e0010">{</span> <span style="color:#66d9ef">BEFORE</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">AFTER</span> <span style="color:#960050;background-color:#1e0010">}</span>
trigger_event: <span style="color:#960050;background-color:#1e0010">{</span> <span style="color:#66d9ef">INSERT</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">UPDATE</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">DELETE</span> <span style="color:#960050;background-color:#1e0010">}</span>
</code></pre></div><h3 id="触发器-实例">触发器-实例</h3>
<p>学生表：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#f92672">`</span>stu<span style="color:#f92672">`</span> (
  <span style="color:#f92672">`</span>name<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">50</span>),
  <span style="color:#f92672">`</span>course<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">50</span>),
  <span style="color:#f92672">`</span>score<span style="color:#f92672">`</span> int(<span style="color:#ae81ff">11</span>),
  <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span> (<span style="color:#f92672">`</span>name<span style="color:#f92672">`</span>)
) ENGINE<span style="color:#f92672">=</span>InnoDB;
</code></pre></div><p>用于更正成绩的触发器：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">DELIMITER</span> <span style="color:#f92672">//</span>
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TRIGGER</span> trg_upd_score
<span style="color:#66d9ef">BEFORE</span> <span style="color:#66d9ef">UPDATE</span> <span style="color:#66d9ef">ON</span> <span style="color:#f92672">`</span>stu<span style="color:#f92672">`</span>
<span style="color:#66d9ef">FOR</span> <span style="color:#66d9ef">EACH</span> <span style="color:#66d9ef">ROW</span>
<span style="color:#66d9ef">BEGIN</span>
  <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">NEW</span>.score <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">THEN</span>
    <span style="color:#66d9ef">SET</span> <span style="color:#66d9ef">NEW</span>.score <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
  ELSEIF <span style="color:#66d9ef">NEW</span>.score <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">100</span> <span style="color:#66d9ef">THEN</span>
    <span style="color:#66d9ef">SET</span> <span style="color:#66d9ef">NEW</span>.score <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>;
  <span style="color:#66d9ef">END</span> <span style="color:#66d9ef">IF</span>;
<span style="color:#66d9ef">END</span>; <span style="color:#f92672">//</span>
<span style="color:#66d9ef">DELIMITER</span> ;
</code></pre></div><h3 id="注意事项">注意事项</h3>
<ul>
<li>触发器对性能有损耗，应慎重使用。</li>
<li>同一类事件在一个表中只能创建一次。</li>
<li>对于事务表，触发器执行失败则整个语句回滚。</li>
<li>Row格式的主从复制，触发器不会在从库上执行。</li>
<li>使用触发器时应防止递归执行。</li>
</ul>
<h3 id="存储过程">存储过程</h3>
<ul>
<li>定义：存储过程是存储在数据库的一组SQL语句集，用户可以通过存储过程名和传参多次调用的程序模块。</li>
<li>特点：
<ul>
<li>使用灵活，可以使用流控制语句，自定义变量等完成复杂的业务逻辑。</li>
<li>提高数据安全性，屏蔽应用程序直接对表的操作，易于进行审计。</li>
<li>减少网络传输。</li>
<li>提高代码维护的复杂度，实际使用中要评估场景是否适合。</li>
</ul>
</li>
</ul>
<h3 id="存储过程-基本语法">存储过程-基本语法</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span>
  [<span style="color:#66d9ef">DEFINER</span> <span style="color:#f92672">=</span> <span style="color:#960050;background-color:#1e0010">{</span> <span style="color:#66d9ef">user</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">CURRENT_USER</span> <span style="color:#960050;background-color:#1e0010">}</span>]
  <span style="color:#66d9ef">PROCEDURE</span> sp_name ([proc_parameter[,...]])
  [characteristic ...] routine_body

proc_parameter:
  [ <span style="color:#66d9ef">IN</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">OUT</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">INOUT</span> ] param_name <span style="color:#66d9ef">type</span>
<span style="color:#66d9ef">type</span>:
  <span style="color:#66d9ef">Any</span> <span style="color:#66d9ef">valid</span> MySQL <span style="color:#66d9ef">data</span> <span style="color:#66d9ef">type</span>
characteristic:
    <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;string&#39;</span>
  <span style="color:#f92672">|</span> [<span style="color:#66d9ef">NOT</span>] <span style="color:#66d9ef">DETERMINISTIC</span>
routine_body:
  <span style="color:#66d9ef">Valid</span> <span style="color:#66d9ef">SQL</span> <span style="color:#66d9ef">routine</span> <span style="color:#66d9ef">statement</span>
</code></pre></div><h3 id="存储过程-实例">存储过程-实例</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">PROCEDURE</span> proc_test1
(<span style="color:#66d9ef">IN</span> total INT, <span style="color:#66d9ef">OUT</span> res INT)
<span style="color:#66d9ef">BEGIN</span>
  <span style="color:#66d9ef">DECLARE</span> i INT;
  <span style="color:#66d9ef">SET</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
  <span style="color:#66d9ef">SET</span> res <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
  <span style="color:#66d9ef">IF</span> total <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">THEN</span>
    <span style="color:#66d9ef">SET</span> total <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
  <span style="color:#66d9ef">END</span> <span style="color:#66d9ef">IF</span>;
  WHILE i <span style="color:#f92672">&lt;=</span> total <span style="color:#66d9ef">DO</span>
    <span style="color:#66d9ef">SET</span> res <span style="color:#f92672">=</span> res <span style="color:#f92672">*</span> i;
    <span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> tbl_proc_test(num) <span style="color:#66d9ef">VALUES</span> (res);
    <span style="color:#66d9ef">SET</span> i <span style="color:#f92672">=</span> i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
  <span style="color:#66d9ef">END</span> WHILE;
<span style="color:#66d9ef">END</span>;
</code></pre></div><h3 id="存储过程-流控制语句">存储过程-流控制语句</h3>
<table>
<thead>
<tr>
<th style="text-align:left">流控制</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">IF</td>
<td style="text-align:left">IF search_condition THEN statement_list [ELSEIF search_condition THEN statement_list][ELSE statement_list] END IF</td>
</tr>
<tr>
<td style="text-align:left">CASE</td>
<td style="text-align:left">CASE case_value WHEN when_value THEN statement_list [ELSE statement_list] END CASE</td>
</tr>
<tr>
<td style="text-align:left">WHILE</td>
<td style="text-align:left">WHILE search_condition DO statement_list END WHILE</td>
</tr>
<tr>
<td style="text-align:left">REPEAT</td>
<td style="text-align:left">REPEAT statement_list UNTIL search_condition END REPEAT</td>
</tr>
</tbody>
</table>
<h3 id="存储过程-调用">存储过程-调用</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">set</span> <span style="color:#f92672">@</span>total<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>;
<span style="color:#66d9ef">set</span> <span style="color:#f92672">@</span>res<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>;
<span style="color:#66d9ef">call</span> proc_test1(<span style="color:#f92672">@</span>total, <span style="color:#f92672">@</span>res);
<span style="color:#66d9ef">select</span> <span style="color:#f92672">@</span>res;
</code></pre></div><h3 id="自定义函数">自定义函数</h3>
<ul>
<li>自定义函数与存储过程类似，但是必须带有返回值(RETURN)。</li>
<li>自定义函数与sum(), max()等MySQL原生函数使用方法类似：
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> func(val);
<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> tbl <span style="color:#66d9ef">where</span> col<span style="color:#f92672">=</span>func(val);
</code></pre></div></li>
<li>由于自定义函数可能在遍历数据中使用，要注意性能损耗</li>
</ul>
<h3 id="自定义函数-基本语法">自定义函数-基本语法</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span>
  [<span style="color:#66d9ef">DEFINER</span> <span style="color:#f92672">=</span> <span style="color:#960050;background-color:#1e0010">{</span> <span style="color:#66d9ef">user</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">CURRENT_USER</span><span style="color:#960050;background-color:#1e0010">}</span>]
  <span style="color:#66d9ef">FUNCTION</span> sp_name ([func_parameter[,...]])
  <span style="color:#66d9ef">RETURNS</span> <span style="color:#66d9ef">type</span>
  [characteristic ...] routine_body
func_parameter:
  param_name <span style="color:#66d9ef">type</span>
<span style="color:#66d9ef">type</span>:
  <span style="color:#66d9ef">Any</span> <span style="color:#66d9ef">valid</span> MySQL <span style="color:#66d9ef">data</span> <span style="color:#66d9ef">type</span>
characteristic:
    <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;string&#39;</span>
  <span style="color:#f92672">|</span> [<span style="color:#66d9ef">NOT</span>] <span style="color:#66d9ef">DETERMINISTIC</span>
routine_body:
  <span style="color:#66d9ef">Valid</span> <span style="color:#66d9ef">SQL</span> <span style="color:#66d9ef">routine</span> <span style="color:#66d9ef">statement</span>
</code></pre></div><h3 id="自定义函数-实例">自定义函数-实例</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">FUNCTION</span> func_test1 (total INT)
<span style="color:#66d9ef">RETURNS</span> INT
<span style="color:#66d9ef">BEGIN</span>
  <span style="color:#66d9ef">DECLARE</span> i INT;
  <span style="color:#66d9ef">DECLARE</span> res INT;
  <span style="color:#66d9ef">SET</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
  <span style="color:#66d9ef">SET</span> res <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
  <span style="color:#66d9ef">IF</span> total <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">THEN</span>
    <span style="color:#66d9ef">SET</span> total <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
  <span style="color:#66d9ef">END</span> <span style="color:#66d9ef">IF</span>;
  WHILE i <span style="color:#f92672">&lt;</span> total <span style="color:#66d9ef">DO</span>
    <span style="color:#66d9ef">SET</span> res <span style="color:#f92672">=</span> res <span style="color:#f92672">*</span> i;
    <span style="color:#66d9ef">SET</span> i <span style="color:#f92672">=</span> i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
  <span style="color:#66d9ef">END</span> WHILE;
  <span style="color:#66d9ef">RETURN</span> res;
<span style="color:#66d9ef">END</span>;
</code></pre></div><h3 id="自定义函数-调用">自定义函数-调用</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> func_test1(<span style="color:#ae81ff">4</span>);
</code></pre></div><h3 id="小结-2">小结</h3>
<ul>
<li>知识点：触发器、存储过程、自定义函数</li>
<li>互联网场景：触发器和存储过程不利于水平扩展，多用于统计和运维操作中。</li>
</ul>
<h2 id="27-mysql字符集">2.7-MySQL字符集</h2>
<h3 id="字符集基础">字符集基础</h3>
<ul>
<li>字符集：数据库中的字符集包含两层含义
<ul>
<li>各种文字和符号的集合，包括各国家文字、标点符号、图形符号、数字等。</li>
<li>字符的编码方式，即二进制数据与字符的映射规则。</li>
</ul>
</li>
</ul>
<h3 id="字符集-分类">字符集-分类</h3>
<ul>
<li>ASCII：美国信息互换标准编码；英语和其他西欧语言；单字节编码，7位表示一个字符，共128字符。</li>
<li>GBK：汉字内码扩展规范；中日韩汉字、英文、数字；双字节编码；共收录了21003个汉字，GB2312的扩展。</li>
<li>UTF-8:Unicode标准的可变长度字符编码；Unicode标准（统一码），业界统一标准，包括世界上数十种文字的系统；UTF-8使用一至四个字节为每个字符编码。</li>
<li>其他常见字符集：UTF-32，UTF-16，Big5，latin1</li>
</ul>
<h3 id="mysql字符集">MySQL字符集</h3>
<ul>
<li>查看字符集</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SHOW</span> CHARACTER <span style="color:#66d9ef">SET</span>;
</code></pre></div><ul>
<li>新增字符集</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># 编译时加入： --with-charset=</span>
./configure --prefix<span style="color:#f92672">=</span>/usr/local/mysql3 --with-plugins<span style="color:#f92672">=</span>innobase --with-charset<span style="color:#f92672">=</span>gbk
</code></pre></div><h3 id="字符集与字符序">字符集与字符序</h3>
<ul>
<li>charset和collation
<ul>
<li>collation：字符序，字符的排序与比较规则，每个字符集都有对应的多套字符序。</li>
<li>不同的字符序决定了字符串在比较排序中的精度和性能不同。</li>
</ul>
</li>
</ul>
<p>查看字符序</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">show</span> <span style="color:#66d9ef">collation</span>;
</code></pre></div><p>mysql的字符序遵从命名惯例：以_ci(表示大小写不敏感)，以_CS(表示大小写敏感)，以_bin(表示用编码值进行比较)。</p>
<h3 id="字符集设置级别">字符集设置级别</h3>
<ul>
<li>charset和collation的设置级别：
<ul>
<li>服务器级 &raquo; 数据库级 &raquo; 表级 &raquo; 列级</li>
</ul>
</li>
<li>服务器级
<ul>
<li>系统变量(可动态设置)：
<ul>
<li>character_set_server：默认的内部操作字符集</li>
<li>character_set_system：系统元数据(各字段名等)字符集</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="字符集设置级别-1">字符集设置级别</h3>
<ul>
<li>服务器级</li>
</ul>
<pre><code>配置文件

[mysqld]
character_set_server=utf8
collation_server=utf8_general_ci
</code></pre><ul>
<li>数据库级</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DATABASE</span> db_name CHARACTER <span style="color:#66d9ef">SET</span> latin1 <span style="color:#66d9ef">COLLATE</span> latin1_swedish_ci;
</code></pre></div><ul>
<li>character_set_database：当前选中数据库的默认字符集</li>
</ul>
<p>主要影响load data等语句的默认字符集，CREATE DATABASE的字符集如果不设置，默认使用character_set_server的字符集。</p>
<ul>
<li>表级</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> tbl1 (....) <span style="color:#66d9ef">DEFAULT</span> CHARSET<span style="color:#f92672">=</span>utf8 <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">COLLATE</span><span style="color:#f92672">=</span>utf8_bin;
</code></pre></div><ul>
<li>列级</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> tbl1 (col1 VARCHAR(<span style="color:#ae81ff">5</span>) CHARACTER <span style="color:#66d9ef">SET</span> latin1 <span style="color:#66d9ef">COLLATE</span> latin1_german1_ci);
</code></pre></div><h3 id="字符集设置级别-2">字符集设置级别</h3>
<ul>
<li>数据存储字符集使用规则：
<ul>
<li>使用列集的CHARACTER SET设定值；</li>
<li>若列级字符集不存在，则使用对应表级的DEFAULT CHARACTER SET设定值；</li>
<li>若表级字符集不存在，则使用数据库级的DEFAULT CHARACTER SET设定值；</li>
<li>若数据库级字符集不存在，则使用服务器级character_set_server设定值。</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#75715e">-- 查看字符集
</span><span style="color:#75715e"></span><span style="color:#66d9ef">show</span> [<span style="color:#66d9ef">global</span>] variables <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;character%&#39;</span>;
<span style="color:#66d9ef">show</span> [<span style="color:#66d9ef">global</span>] variables <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;collation%&#39;</span>;

<span style="color:#75715e">-- 修改字符集
</span><span style="color:#75715e"></span><span style="color:#66d9ef">set</span> <span style="color:#66d9ef">global</span> character_set_server<span style="color:#f92672">=</span>utf8; <span style="color:#75715e">-- 全局
</span><span style="color:#75715e"></span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> xxx <span style="color:#66d9ef">convert</span> <span style="color:#66d9ef">to</span> character <span style="color:#66d9ef">set</span> xxx; <span style="color:#75715e">-- 表
</span></code></pre></div><h3 id="客户端连接与字符集">客户端连接与字符集</h3>
<ul>
<li>连接与字符集
<ul>
<li>character_set_client：客户端来源数据使用的字符集。</li>
<li>character_set_connection：连接层字符集。</li>
<li>character_set_results：查询结果字符集。</li>
</ul>
</li>
</ul>
<pre><code>mysql &gt; set names utf8;

配置文件设置：
[mysql]
default-character-set=utf8
</code></pre><ul>
<li>字符转换过程</li>
</ul>
<p>client &gt; character_set_client &gt; character_set_connection &gt; Storage &gt; character_set_results &gt;client</p>
<p>推荐使用统一的字符集</p>
<ul>
<li>
<p>常见乱码原因：</p>
<ul>
<li>数据存储字符集不能正确编码(不支持)client发来的数据：client(utf8)-&gt;Storage(latin1)</li>
<li>程序连接使用的字符集与通知mysql的character_set_client等不一致或不兼容。</li>
</ul>
</li>
<li>
<p>使用建议</p>
<ul>
<li>创建数据库/表时显式的指定字符集，不使用默认。</li>
<li>连接字符集与存储字符集设置一致，推荐使用utf8。</li>
<li>驱动程序连接时显式指定字符集(set names XXX).</li>
</ul>
</li>
<li>
<p>mysql CAPI:初始化数据库句柄后马上用mysql_options设定MYSQL_CHARSET_NAME属性为utf8.</p>
</li>
<li>
<p>mysql php API:连接到数据库以后显式用SET NAMES语句设置一次连接字符集。</p>
</li>
<li>
<p>mysql JDBC: url=&ldquo;jdbc:mysql://localhost:3306/blog_dbo?user=xx&amp;password=xx&amp;userUnicode=true&amp;characterEncoding=utf8&rdquo;</p>
</li>
</ul>
<h3 id="小结-3">小结</h3>
<ul>
<li>字符集：表示的字符集和/字符编码方式</li>
<li>字符的设置级别：服务器/数据库/表/列</li>
<li>客户端字符集：乱码产生的原因与解决方式</li>
</ul>
<h2 id="28程序连接mysql">2.8程序连接MySQL</h2>
<h3 id="程序连接mysql基本原理">程序连接MySQL基本原理</h3>
<p>JDBC客户端应用 -&gt; java.sql.*或javax.sql.* -&gt; 驱动程序 -&gt; SQLserver/Oracle/MySQL</p>
<h3 id="java代码示例">Java代码示例</h3>
<p>结构：</p>
<p>DriverManager
-&gt; Driver(是驱动程序对象的接口，指向具体数据库驱动程序对象)=DriverManager.getDriver(String URL)
-&gt; Connectinon(是连接对象接口，指向具体数据库连接对象)=DriverManager.getConnection(String URL)
-&gt; Statement(执行静态SQL语句接口)=Connection.CreateStatement()
-&gt; ResultSet(是指向结果集对象的接口)=Statement.excuteXXX()</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> java.sql.*<span style="color:#f92672">;</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * 使用JDBC连接MySQL
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DBTest</span> <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> Connection <span style="color:#a6e22e">getConnection</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> SQLException<span style="color:#f92672">,</span>
            java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">ClassNotFoundException</span>
    <span style="color:#f92672">{</span>
        <span style="color:#75715e">//第一步：加载MySQL的JDBC的驱动
</span><span style="color:#75715e"></span>        Class<span style="color:#f92672">.</span><span style="color:#a6e22e">forName</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;com.mysql.jdbc.Driver&#34;</span><span style="color:#f92672">);</span>

        <span style="color:#75715e">//设置MySQL连接字符串,要访问的MySQL数据库 ip,端口,用户名,密码
</span><span style="color:#75715e"></span>        String url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;jdbc:mysql://localhost:3306/blog&#34;</span><span style="color:#f92672">;</span>        
        String username <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;blog_user&#34;</span><span style="color:#f92672">;</span>
        String password <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;blog_pwd&#34;</span><span style="color:#f92672">;</span>

        <span style="color:#75715e">//第二步：创建与MySQL数据库的连接类的实例
</span><span style="color:#75715e"></span>        Connection con <span style="color:#f92672">=</span> DriverManager<span style="color:#f92672">.</span><span style="color:#a6e22e">getConnection</span><span style="color:#f92672">(</span>url<span style="color:#f92672">,</span> username<span style="color:#f92672">,</span> password<span style="color:#f92672">);</span>        
        <span style="color:#66d9ef">return</span> con<span style="color:#f92672">;</span>        
    <span style="color:#f92672">}</span>


    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String args<span style="color:#f92672">[])</span> <span style="color:#f92672">{</span>
        Connection con <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">try</span>
        <span style="color:#f92672">{</span>
            <span style="color:#75715e">//第三步：获取连接类实例con，用con创建Statement对象类实例 sql_statement
</span><span style="color:#75715e"></span>            con <span style="color:#f92672">=</span> getConnection<span style="color:#f92672">();</span>            
            Statement sql_statement <span style="color:#f92672">=</span> con<span style="color:#f92672">.</span><span style="color:#a6e22e">createStatement</span><span style="color:#f92672">();</span>

            <span style="color:#75715e">/************ 对数据库进行相关操作 ************/</span>                
            <span style="color:#75715e">//如果同名数据库存在，删除
</span><span style="color:#75715e"></span>            sql_statement<span style="color:#f92672">.</span><span style="color:#a6e22e">executeUpdate</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;drop table if exists user;&#34;</span><span style="color:#f92672">);</span>            
            <span style="color:#75715e">//执行了一个sql语句生成了一个名为user的表
</span><span style="color:#75715e"></span>            sql_statement<span style="color:#f92672">.</span><span style="color:#a6e22e">executeUpdate</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;create table user (id int not null auto_increment,&#34;</span> <span style="color:#f92672">+</span>
                    <span style="color:#e6db74">&#34; name varchar(20) not null default &#39;name&#39;, age int not null default 0, primary key (id) ); &#34;</span><span style="color:#f92672">);</span>

            <span style="color:#75715e">//向表中插入数据
</span><span style="color:#75715e"></span>            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;JDBC 插入操作:&#34;</span><span style="color:#f92672">);</span>
            String sql <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;insert into user(name,age) values(&#39;liming&#39;, 18)&#34;</span><span style="color:#f92672">;</span>

            <span style="color:#66d9ef">int</span> num <span style="color:#f92672">=</span> sql_statement<span style="color:#f92672">.</span><span style="color:#a6e22e">executeUpdate</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;insert into user(name,age) values(&#39;liming&#39;, 18)&#34;</span><span style="color:#f92672">);</span>
            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;execute sql : &#34;</span> <span style="color:#f92672">+</span> sql<span style="color:#f92672">);</span>
            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>num <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; rows has changed!&#34;</span><span style="color:#f92672">);</span>
            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">);</span>

            <span style="color:#75715e">//第四步：执行查询，用ResultSet类的对象，返回查询的结果
</span><span style="color:#75715e"></span>            String query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;select * from user&#34;</span><span style="color:#f92672">;</span>            
            ResultSet result <span style="color:#f92672">=</span> sql_statement<span style="color:#f92672">.</span><span style="color:#a6e22e">executeQuery</span><span style="color:#f92672">(</span>query<span style="color:#f92672">);</span>

            <span style="color:#75715e">/************ 对数据库进行相关操作 ************/</span>

            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;JDBC 查询操作:&#34;</span><span style="color:#f92672">);</span>
            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;------------------------&#34;</span><span style="color:#f92672">);</span>
            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;userid&#34;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; &#34;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;name&#34;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; &#34;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;age &#34;</span><span style="color:#f92672">);</span>
            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;------------------------&#34;</span><span style="color:#f92672">);</span>

            <span style="color:#75715e">//对获得的查询结果进行处理，对Result类的对象进行操作
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>result<span style="color:#f92672">.</span><span style="color:#a6e22e">next</span><span style="color:#f92672">())</span>
            <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">int</span> userid <span style="color:#f92672">=</span>   result<span style="color:#f92672">.</span><span style="color:#a6e22e">getInt</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;id&#34;</span><span style="color:#f92672">);</span>
                String name    <span style="color:#f92672">=</span>   result<span style="color:#f92672">.</span><span style="color:#a6e22e">getString</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;name&#34;</span><span style="color:#f92672">);</span>
                <span style="color:#66d9ef">int</span> age        <span style="color:#f92672">=</span>   result<span style="color:#f92672">.</span><span style="color:#a6e22e">getInt</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;age&#34;</span><span style="color:#f92672">);</span>
                <span style="color:#75715e">//取得数据库中的数据
</span><span style="color:#75715e"></span>                System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34; &#34;</span> <span style="color:#f92672">+</span> userid <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; &#34;</span> <span style="color:#f92672">+</span> name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; &#34;</span> <span style="color:#f92672">+</span> age<span style="color:#f92672">);</span>                
            <span style="color:#f92672">}</span>

            <span style="color:#75715e">//关闭 result,sql_statement
</span><span style="color:#75715e"></span>            result<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
            sql_statement<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>

            <span style="color:#75715e">//使用PreparedStatement更新记录
</span><span style="color:#75715e"></span>            sql <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;update user set age=? where name=?;&#34;</span><span style="color:#f92672">;</span>
            PreparedStatement pstmt <span style="color:#f92672">=</span> con<span style="color:#f92672">.</span><span style="color:#a6e22e">prepareStatement</span><span style="color:#f92672">(</span>sql<span style="color:#f92672">);</span>

            <span style="color:#75715e">//设置绑定变量的值
</span><span style="color:#75715e"></span>            pstmt<span style="color:#f92672">.</span><span style="color:#a6e22e">setInt</span><span style="color:#f92672">(</span>1<span style="color:#f92672">,</span> 15<span style="color:#f92672">);</span>
            pstmt<span style="color:#f92672">.</span><span style="color:#a6e22e">setString</span><span style="color:#f92672">(</span>2<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;liming&#34;</span><span style="color:#f92672">);</span>

            <span style="color:#75715e">//执行操作
</span><span style="color:#75715e"></span>            num <span style="color:#f92672">=</span> pstmt<span style="color:#f92672">.</span><span style="color:#a6e22e">executeUpdate</span><span style="color:#f92672">();</span>

            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">);</span>
            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;JDBC 更新操作:&#34;</span><span style="color:#f92672">);</span>
            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;execute sql : &#34;</span> <span style="color:#f92672">+</span> sql<span style="color:#f92672">);</span>
            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>num <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; rows has changed!&#34;</span><span style="color:#f92672">);</span>

            <span style="color:#75715e">//关闭PreparedStatement
</span><span style="color:#75715e"></span>            pstmt<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>


            <span style="color:#75715e">//流式读取result，row-by-row
</span><span style="color:#75715e"></span>            query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;select * from user&#34;</span><span style="color:#f92672">;</span>            
            PreparedStatement ps <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>PreparedStatement<span style="color:#f92672">)</span> con<span style="color:#f92672">.</span><span style="color:#a6e22e">prepareStatement</span>
            <span style="color:#f92672">(</span>query<span style="color:#f92672">,</span>ResultSet<span style="color:#f92672">.</span><span style="color:#a6e22e">TYPE_FORWARD_ONLY</span><span style="color:#f92672">,</span> ResultSet<span style="color:#f92672">.</span><span style="color:#a6e22e">CONCUR_READ_ONLY</span><span style="color:#f92672">);</span>  

            ps<span style="color:#f92672">.</span><span style="color:#a6e22e">setFetchSize</span><span style="color:#f92672">(</span>Integer<span style="color:#f92672">.</span><span style="color:#a6e22e">MIN_VALUE</span><span style="color:#f92672">);</span>  

            result <span style="color:#f92672">=</span> ps<span style="color:#f92672">.</span><span style="color:#a6e22e">executeQuery</span><span style="color:#f92672">();</span>  

            <span style="color:#75715e">/************ 对数据库进行相关操作 ************/</span>

            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;JDBC 查询操作:&#34;</span><span style="color:#f92672">);</span>
            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;------------------------&#34;</span><span style="color:#f92672">);</span>
            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;userid&#34;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; &#34;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;name&#34;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; &#34;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;age &#34;</span><span style="color:#f92672">);</span>
            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;------------------------&#34;</span><span style="color:#f92672">);</span>

            <span style="color:#75715e">//对获得的查询结果进行处理，对Result类的对象进行操作
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>result<span style="color:#f92672">.</span><span style="color:#a6e22e">next</span><span style="color:#f92672">())</span>
            <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">int</span> userid <span style="color:#f92672">=</span>   result<span style="color:#f92672">.</span><span style="color:#a6e22e">getInt</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;id&#34;</span><span style="color:#f92672">);</span>
                String name    <span style="color:#f92672">=</span>   result<span style="color:#f92672">.</span><span style="color:#a6e22e">getString</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;name&#34;</span><span style="color:#f92672">);</span>
                <span style="color:#66d9ef">int</span> age        <span style="color:#f92672">=</span>   result<span style="color:#f92672">.</span><span style="color:#a6e22e">getInt</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;age&#34;</span><span style="color:#f92672">);</span>
                <span style="color:#75715e">//取得数据库中的数据
</span><span style="color:#75715e"></span>                System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34; &#34;</span> <span style="color:#f92672">+</span> userid <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; &#34;</span> <span style="color:#f92672">+</span> name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; &#34;</span> <span style="color:#f92672">+</span> age<span style="color:#f92672">);</span>                
            <span style="color:#f92672">}</span>

            <span style="color:#75715e">//关闭 result,ps
</span><span style="color:#75715e"></span>            result<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
            ps<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
            con<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>

        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">ClassNotFoundException</span> e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">//加载JDBC错误,所要用的驱动没有找到
</span><span style="color:#75715e"></span>            System<span style="color:#f92672">.</span><span style="color:#a6e22e">err</span><span style="color:#f92672">.</span><span style="color:#a6e22e">print</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ClassNotFoundException&#34;</span><span style="color:#f92672">);</span>
            <span style="color:#75715e">//其他错误
</span><span style="color:#75715e"></span>            System<span style="color:#f92672">.</span><span style="color:#a6e22e">err</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>e<span style="color:#f92672">.</span><span style="color:#a6e22e">getMessage</span><span style="color:#f92672">());</span>
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>SQLException ex<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">//显示数据库连接错误或查询错误
</span><span style="color:#75715e"></span>            System<span style="color:#f92672">.</span><span style="color:#a6e22e">err</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;SQLException: &#34;</span> <span style="color:#f92672">+</span> ex<span style="color:#f92672">.</span><span style="color:#a6e22e">getMessage</span><span style="color:#f92672">());</span>
        <span style="color:#f92672">}</span>


    <span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>
</code></pre></div><h3 id="jdbc使用技巧">JDBC使用技巧</h3>
<ul>
<li>Statement与PreparedStatement的区别</li>
<li>connection, Statement与ResultSet关闭的意义</li>
<li>jdbc连接参数的使用</li>
<li>ResultSet游标的使用(setFetchSize)</li>
</ul>
<h3 id="statement与preparedstatement的区别">Statement与PreparedStatement的区别</h3>
<ul>
<li>PreparedStatement在数据库端预编译，效率高，可以防止SQL注入。</li>
<li>对数据库执行一次性存取的时候，用Statement对象进行处理。</li>
<li>线上业务推荐使用PreparedStatement.</li>
</ul>
<h3 id="preparedstatement背后的故事">PreparedStatement背后的故事</h3>
<p>PREPARE -&gt; EXECUTE -&gt; DEALLOCATE PREPARE</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">PREPARE</span> stmt1 <span style="color:#66d9ef">FROM</span> <span style="color:#e6db74">&#39;SELECT productCode, productName
</span><span style="color:#e6db74">                    From products
</span><span style="color:#e6db74">                    WHERE productCode = ?&#39;</span>;
<span style="color:#66d9ef">SET</span> <span style="color:#f92672">@</span>pc <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;S10_1678&#39;</span>;
<span style="color:#66d9ef">EXECUTE</span> stmt1 <span style="color:#66d9ef">USING</span> <span style="color:#f92672">@</span>pc;

<span style="color:#66d9ef">DEALLOCATE</span> <span style="color:#66d9ef">PREPARE</span> stmt1;
</code></pre></div><h3 id="connection-statement与resultset关闭的意义">connection, Statement与ResultSet关闭的意义</h3>
<ul>
<li>MySQL数据库端为connection与ResultSet维护内存状态，一直不关闭会占用服务端资源。</li>
<li>MySQL最大连接数受max_connections限制，不能无限创建连接，所以用完要及时关闭。</li>
<li>JDBC connection关闭后ResultSet, Statement会自动关闭。但是如果使用连接池将不会关闭，因此推荐主动关闭。</li>
</ul>
<h3 id="jdbc连接参数的使用">jdbc连接参数的使用</h3>
<ul>
<li>字符集设置：</li>
</ul>
<p>url=&ldquo;jdbc:mysql://localhost:3306/blog_dbo?userUnicode=true&amp;characterEncoding=utf8&rdquo;;</p>
<ul>
<li>超时设置：</li>
</ul>
<p>url=&ldquo;jdbc:mysql://localhost:3306/blog_dbo?connectionTimeout=1000&amp;socketTimeout=30000&rdquo;;</p>
<h3 id="resultset游标的使用">ResultSet游标的使用</h3>
<ul>
<li>默认的ResultSet对象不可更新，仅有一个向前移动的指针。因此，只能迭代它一次，并且只能按从第一行到最后一行的顺序进行。可以生成可滚动和/或可更新的ResultSet对象。</li>
<li>setFetchSize()是设置ResultSet每次向数据库取的行数，防止数据返回量过大将内存爆掉。</li>
</ul>
<h3 id="python连接mysql">Python连接MySQL</h3>
<ul>
<li>Python：脚本语言，无需编译、易开发</li>
<li>DBA使用Python的一般场景是编写自动化运维工具、报表、数据迁移</li>
<li>Python MySQL驱动：python-mysqldb</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> MySQLdb

<span style="color:#75715e"># 建立和mysql数据库的连接</span>
conn <span style="color:#f92672">=</span> MySQLdb<span style="color:#f92672">.</span>connect(host<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;localhost&#39;</span>, port<span style="color:#f92672">=</span><span style="color:#ae81ff">3306</span>,user<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;bloguser&#39;</span>,passwd<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;xxxx&#39;</span>)
<span style="color:#75715e"># 获取游标</span>
curs <span style="color:#f92672">=</span> conn<span style="color:#f92672">.</span>cursor()

<span style="color:#75715e"># 选择数据库</span>
conn<span style="color:#f92672">.</span>select_db(<span style="color:#e6db74">&#39;blog&#39;</span>)

<span style="color:#75715e"># 执行SQL，创建一个表</span>
curs<span style="color:#f92672">.</span>execute(<span style="color:#e6db74">&#34;create table blog (id int, name varchar(200))&#34;</span>)

<span style="color:#75715e"># 插入一条记录</span>
value <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;user1&#39;</span>]
curs<span style="color:#f92672">.</span>execute(<span style="color:#e6db74">&#34;insert into blog values(</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">, </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">)&#34;</span>, value)

<span style="color:#75715e"># 插入多条记录</span>
values <span style="color:#f92672">=</span> [(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;user2&#34;</span>), (<span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#34;user3&#34;</span>)]
curs<span style="color:#f92672">.</span>executemany(<span style="color:#e6db74">&#34;insert into blog values(</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">, </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">)&#34;</span>, values)

<span style="color:#75715e"># 提交</span>
conn<span style="color:#f92672">.</span>commit()

<span style="color:#75715e"># 关闭游标</span>
curs<span style="color:#f92672">.</span>close()
<span style="color:#75715e"># 关闭连接</span>
conn<span style="color:#f92672">.</span>close()
</code></pre></div><h2 id="29-dao框架的使用">2.9-DAO框架的使用</h2>
<h3 id="dao框架">DAO框架</h3>
<ul>
<li>在应用程序中使用数据访问对象(DAO),使我们可以将底层数据访问逻辑与业务逻辑分离开来。DAO框架构建了为每一个数据源提供CRUD(创建、读取、更新、删除)操作的类。</li>
<li>DAO模式是标准J2EE设计模式之一。开发人员用这种模式将底层数据访问操作与高层业务逻辑分离开。一个典型的DAO框架实现有以下组操作：
<ul>
<li>一个DAO工厂类</li>
<li>一个DAO接口(select/insert/delete/update)</li>
<li>一个实现了DAO接口的具体类</li>
<li>数据传输对象</li>
</ul>
</li>
</ul>
<h3 id="dao框架的特点">DAO框架的特点</h3>
<ul>
<li>屏蔽底层数据访问细节，实现业务逻辑和数据访问逻辑的分离。</li>
<li>简化代码开发，提高代码复用率。</li>
<li>相较于原生的SQL可能会带来额外的 性能损耗(利用反射机制封装对象，SQL转换等)</li>
</ul>
<h3 id="mybatis简介">MyBatis简介</h3>
<ul>
<li>MyBatis是一个主流的DAO框架，是apache的一个开源项目iBatis的升级版。</li>
<li>MyBatis支持普通SQL查询，存储过程和高级映射，消除就几乎所有JDBC代码和参数的手工设置以及结果集的检索。</li>
<li>接口丰富、使用简单</li>
<li>相较于hibernate更加轻量级，支持原生的sql语句。</li>
<li>支持查询缓存</li>
</ul>
<h3 id="mybatis代码示例">MyBatis代码示例</h3>
<ul>
<li>环境搭建，数据源于映射配置文件的编写</li>
<li>单值、多值查询</li>
<li>增删改数据</li>
<li>连表查询</li>
</ul>
<p><strong>示例代码在sorence/DAO框架代码示例.rar</strong></p>
<h3 id="mybatis工作流程">MyBatis工作流程</h3>
<ul>
<li>加载配置并初始化，内部生成MappedStatement对象。</li>
<li>调用MyBatis提供的API(SqlSession.select/insert&hellip;.)，将SQL ID与数据对象传递给处理层。</li>
<li>处理层解析MappedStatement对象，获取MySQL的连接，执行相应的SQL语句，接收返回结果。</li>
<li>MyBatis将接收到的返回结果封装成对应的数据对象返回。</li>
</ul>
<h3 id="mybatis使用技巧">MyBatis使用技巧</h3>
<ul>
<li>区分<code>#{}</code>和<code>${}</code>的不同应用场景：
<code>#{}</code>会生成预编译SQL，会正确的处理数据的类型，而<code>${}</code>仅仅是文本替换。</li>
<li>注意MyBatis封装数据时的性能损耗：
只返回需要的行数和字段。</li>
<li>使用MyBatis自带的连接池功能：
<code>&lt;dataSource type=&quot;POOLED&quot;&gt;</code></li>
</ul>
<h2 id="回到上一级"><a href="../">回到上一级</a></h2>
<div class="edit-meta">
Last updated on 17 Jan 2020


<br>
Published on 17 Jan 2020
<br></div><nav class="pagination"><a class="nav nav-prev" href="https://huachengzhou.github.io/cycle/databases/mysql_163%E8%AF%BE%E5%A0%82/%E7%BD%91%E6%98%93%E4%BA%91%E8%AF%BE%E5%A0%82mysql_chapter1/" title="MySQL数据库基础"><i class="fas fa-arrow-left" aria-hidden="true"></i> Prev - MySQL数据库基础</a>
<a class="nav nav-next" href="https://huachengzhou.github.io/cycle/databases/mysql_163%E8%AF%BE%E5%A0%82/%E7%BD%91%E6%98%93%E4%BA%91%E8%AF%BE%E5%A0%82mysql_chapter5/" title="MySQL运维实践">Next - MySQL运维实践 <i class="fas fa-arrow-right" aria-hidden="true"></i></a>
</nav><footer><p class="powered">

 <ul>
  <li>当你的才华还撑不起你的野心时,</li>
  <li>那你就应该静下心来学习;</li>
  <li>当你的能力还驾驭不了你的目标时,</li>
  <li>那就应该沉下心来历练.</li>
</ul>
</p>
</footer>
</main>
<div class="sidebar">

<nav class="open-menu">
<ul>
<li class=""><a href="https://huachengzhou.github.io/cycle">Home</a></li>

<li class=""><a href="https://huachengzhou.github.io/cycle/computer_network/">计算机网络 </a>
  
<ul class="sub-menu">

<li class=""><a href="https://huachengzhou.github.io/cycle/computer_network/network_architecture/">网络体系结构</a>
  
<ul class="sub-menu">
<li class=""><a href="https://huachengzhou.github.io/cycle/computer_network/network_architecture/1.1.1%E8%AE%A1%E7%AE%97%E6%9C%BA%E6%A6%82%E5%BF%B5-%E7%BB%84%E6%88%90-%E5%8A%9F%E8%83%BD-%E5%88%86%E7%B1%BB/">计算机概念 组成 功能 分类 * </a></li>
<li class=""><a href="https://huachengzhou.github.io/cycle/computer_network/network_architecture/1.1.2%E6%A0%87%E5%87%86%E5%8C%96%E5%B7%A5%E4%BD%9C%E5%8F%8A%E7%9B%B8%E5%85%B3%E7%BB%84%E7%BB%87/">标准的分类</a></li>
<li class=""><a href="https://huachengzhou.github.io/cycle/computer_network/network_architecture/1.1.3%E9%80%9F%E7%8E%87%E7%9B%B8%E5%85%B3%E7%9A%84%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87/">速率</a></li>
<li class=""><a href="https://huachengzhou.github.io/cycle/computer_network/network_architecture/%E5%88%86%E5%B1%82%E7%BB%93%E6%9E%84/">分层结构</a></li>
<li class=""><a href="https://huachengzhou.github.io/cycle/computer_network/network_architecture/%E5%88%86%E5%B1%82%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B/">分层参考模型</a></li>
<li class=""><a href="https://huachengzhou.github.io/cycle/computer_network/network_architecture/%E6%A8%A1%E5%9E%8B%E5%B1%82%E6%AC%A1%E8%AF%A6%E8%A7%A3/">模型层次详解</a></li>
</ul>
  
</li>

<li class=""><a href="https://huachengzhou.github.io/cycle/computer_network/physical_layer/">物理层 </a>
  
<ul class="sub-menu">
<li class=""><a href="https://huachengzhou.github.io/cycle/computer_network/physical_layer/%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A1%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/">数据通信基础知识 </a></li>
<li class=""><a href="https://huachengzhou.github.io/cycle/computer_network/physical_layer/%E7%89%A9%E7%90%86%E5%B1%82%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/">物理层基本概念 </a></li>
</ul>
  
</li>

<li class=""><a href="https://huachengzhou.github.io/cycle/computer_network/data_link_layer/">数据链路层 </a>
  
</li>

<li class=""><a href="https://huachengzhou.github.io/cycle/computer_network/network_layer/">网络层 </a>
  
</li>

<li class=""><a href="https://huachengzhou.github.io/cycle/computer_network/transport_layer/">传输层 </a>
  
</li>

<li class=""><a href="https://huachengzhou.github.io/cycle/computer_network/application_layer/">应用层 </a>
  
</li>
</ul>
  
</li>

<li class=""><a href="https://huachengzhou.github.io/cycle/hugo%E5%AD%A6%E4%B9%A0/">hugo教程</a>
  
<ul class="sub-menu">
<li class=""><a href="https://huachengzhou.github.io/cycle/hugo%E5%AD%A6%E4%B9%A0/hugo_server_faile_-to_get_json/">hugo教程 hugo server Failed to get JSON</a></li>
<li class=""><a href="https://huachengzhou.github.io/cycle/hugo%E5%AD%A6%E4%B9%A0/hugo_tutorials1/">hugo教程1</a></li>
<li class=""><a href="https://huachengzhou.github.io/cycle/hugo%E5%AD%A6%E4%B9%A0/hugo_tutorials2/">hugo教程2</a></li>
</ul>
  
</li>

<li class=""><a href="https://huachengzhou.github.io/cycle/%E8%84%9A%E6%9C%AC/">脚本</a>
  
</li>

<li class=""><a href="https://huachengzhou.github.io/cycle/%E8%87%AA%E6%88%91%E6%8F%90%E5%8D%87/">自我提升</a>
  
<ul class="sub-menu">
<li class=""><a href="https://huachengzhou.github.io/cycle/%E8%87%AA%E6%88%91%E6%8F%90%E5%8D%87/2021-04%E5%AD%A6%E4%B9%A0%E8%AE%A1%E5%88%92/">学习计划</a></li>

<li class=""><a href="https://huachengzhou.github.io/cycle/%E8%87%AA%E6%88%91%E6%8F%90%E5%8D%87/%E8%8E%B7%E5%8F%96%E9%87%91%E9%92%B1/">获取金钱</a>
  
<ul class="sub-menu">
<li class=""><a href="https://huachengzhou.github.io/cycle/%E8%87%AA%E6%88%91%E6%8F%90%E5%8D%87/%E8%8E%B7%E5%8F%96%E9%87%91%E9%92%B1/%E5%A6%82%E4%BD%95%E5%9C%A8%E6%B2%B9%E7%AE%A1youtube%E5%BC%80%E9%80%9A%E6%94%B6%E7%9B%8A%E8%B5%9A%E9%92%B1/">如何在油管YouTube开通收益赚钱</a></li>
</ul>
  
</li>

<li class=""><a href="https://huachengzhou.github.io/cycle/%E8%87%AA%E6%88%91%E6%8F%90%E5%8D%87/%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98/">解决问题</a>
  
<ul class="sub-menu">

<li class=""><a href="https://huachengzhou.github.io/cycle/%E8%87%AA%E6%88%91%E6%8F%90%E5%8D%87/%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98/git_andsower/">git出现的问题</a>
  
<ul class="sub-menu">
<li class=""><a href="https://huachengzhou.github.io/cycle/%E8%87%AA%E6%88%91%E6%8F%90%E5%8D%87/%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98/git_andsower/git%E5%A4%84%E7%90%86/">git处理网络和权限问题</a></li>
</ul>
  
</li>

<li class=""><a href="https://huachengzhou.github.io/cycle/%E8%87%AA%E6%88%91%E6%8F%90%E5%8D%87/%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98/idea/">idea出现的问题</a>
  
<ul class="sub-menu">
<li class=""><a href="https://huachengzhou.github.io/cycle/%E8%87%AA%E6%88%91%E6%8F%90%E5%8D%87/%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98/idea/idea/">idea 解决working directory 设置到 target</a></li>
</ul>
  
</li>

<li class=""><a href="https://huachengzhou.github.io/cycle/%E8%87%AA%E6%88%91%E6%8F%90%E5%8D%87/%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98/maven/">maven出现的问题</a>
  
<ul class="sub-menu">
<li class=""><a href="https://huachengzhou.github.io/cycle/%E8%87%AA%E6%88%91%E6%8F%90%E5%8D%87/%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98/maven/idea%E8%A7%A3%E5%86%B3/">idea 问题解决</a></li>
</ul>
  
</li>

<li class=""><a href="https://huachengzhou.github.io/cycle/%E8%87%AA%E6%88%91%E6%8F%90%E5%8D%87/%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98/visual_studio_code/">visual_studio_code</a>
  
<ul class="sub-menu">
<li class=""><a href="https://huachengzhou.github.io/cycle/%E8%87%AA%E6%88%91%E6%8F%90%E5%8D%87/%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98/visual_studio_code/visualstudiocode%E9%97%AE%E9%A2%98/">Visual Studio Code 问题解决方案</a></li>
</ul>
  
</li>
<li class=""><a href="https://huachengzhou.github.io/cycle/%E8%87%AA%E6%88%91%E6%8F%90%E5%8D%87/%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98/dnf%E6%B1%A1%E6%9F%93/">DNS 污染</a></li>
<li class=""><a href="https://huachengzhou.github.io/cycle/%E8%87%AA%E6%88%91%E6%8F%90%E5%8D%87/%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98/githubpages%E7%BB%91%E5%AE%9A%E6%9D%A5%E8%87%AA%E9%98%BF%E9%87%8C%E4%BA%91%E7%9A%84%E5%9F%9F%E5%90%8D/">GitHubPages绑定来自阿里云的域名</a></li>
</ul>
  
</li>
<li class=""><a href="https://huachengzhou.github.io/cycle/%E8%87%AA%E6%88%91%E6%8F%90%E5%8D%87/%E8%AE%B0%E5%BF%86/">记忆方法</a></li>
<li class=""><a href="https://huachengzhou.github.io/cycle/%E8%87%AA%E6%88%91%E6%8F%90%E5%8D%87/%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95/">学习方法</a></li>
<li class=""><a href="https://huachengzhou.github.io/cycle/%E8%87%AA%E6%88%91%E6%8F%90%E5%8D%87/%E5%86%A5%E6%83%B3/">冥想</a></li>
</ul>
  
</li>

<li class=""><a href="https://huachengzhou.github.io/cycle/javadir/"> Java技术栈</a>
  
<ul class="sub-menu">

<li class=""><a href="https://huachengzhou.github.io/cycle/javadir/basedir/">Java基础知识 </a>
  
<ul class="sub-menu">

<li class=""><a href="https://huachengzhou.github.io/cycle/javadir/basedir/jsp_dir/">jsp 基础知识 </a>
  
<ul class="sub-menu">
<li class=""><a href="https://huachengzhou.github.io/cycle/javadir/basedir/jsp_dir/java_%E7%9B%91%E5%90%AC%E4%BA%8B%E4%BB%B6%E5%8E%9F%E7%90%86/">java_监听事件原理 </a></li>
<li class=""><a href="https://huachengzhou.github.io/cycle/javadir/basedir/jsp_dir/jsp_el%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/">EL基础教程 </a></li>
<li class=""><a href="https://huachengzhou.github.io/cycle/javadir/basedir/jsp_dir/jsp_jstl_core%E6%A0%87%E7%AD%BE%E5%BA%93/">jsp jstl core 标签库 </a></li>
<li class=""><a href="https://huachengzhou.github.io/cycle/javadir/basedir/jsp_dir/jsp_jstl_session/">jsp jstl session </a></li>
<li class=""><a href="https://huachengzhou.github.io/cycle/javadir/basedir/jsp_dir/jsp_%E5%AD%97%E7%AC%A6%E4%B8%B2el%E8%A1%A8%E8%BE%BE%E5%BC%8F/">字符串el表达式 </a></li>
</ul>
  
</li>
</ul>
  
</li>

<li class=""><a href="https://huachengzhou.github.io/cycle/javadir/groovy/">groovy 学习与使用 </a>
  
<ul class="sub-menu">
<li class=""><a href="https://huachengzhou.github.io/cycle/javadir/groovy/groovy%E5%AD%A6%E4%B9%A0/"> Groovy 概述 </a></li>
<li class=""><a href="https://huachengzhou.github.io/cycle/javadir/groovy/groovy%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/">groovy 基本概念 </a></li>
<li class=""><a href="https://huachengzhou.github.io/cycle/javadir/groovy/groovy%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/">groovy 数据类型 </a></li>
<li class=""><a href="https://huachengzhou.github.io/cycle/javadir/groovy/groovy%E5%8F%98%E9%87%8F%E5%92%8C%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%8A%A0%E5%BC%BA/"> groovy变量和数据类型 </a></li>
<li class=""><a href="https://huachengzhou.github.io/cycle/javadir/groovy/%E5%A6%82%E4%BD%95%E5%9C%A8groovy%E4%B8%AD%E8%8E%B7%E5%8F%96%E4%BB%A5%E5%8F%A6%E4%B8%80%E4%B8%AA%E5%8F%98%E9%87%8F%E5%91%BD%E5%90%8D%E7%9A%84%E5%8F%98%E9%87%8F%E7%9A%84%E5%80%BC/"> groovy变量值获取 </a></li>
<li class=""><a href="https://huachengzhou.github.io/cycle/javadir/groovy/groovy%E4%B8%AD%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%AF%94%E8%BE%83%E4%BB%A5%E5%8F%8A%E9%9D%9E%E7%A9%BA%E5%88%A4%E6%96%AD/"> groovy对象比较以及空判断 </a></li>
<li class=""><a href="https://huachengzhou.github.io/cycle/javadir/groovy/groovy%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF/"> groovy使用场景 </a></li>
<li class=""><a href="https://huachengzhou.github.io/cycle/javadir/groovy/groovy%E5%8F%98%E9%87%8F/"></a></li>
</ul>
  
</li>

<li class=""><a href="https://huachengzhou.github.io/cycle/javadir/tooldoc/">Java公共库文档总结 </a>
  
<ul class="sub-menu">
<li class=""><a href="https://huachengzhou.github.io/cycle/javadir/tooldoc/apache-common%E5%B7%A5%E5%85%B7%E5%8C%85/">Apache Commons 工具类介绍及简单使用</a></li>
<li class=""><a href="https://huachengzhou.github.io/cycle/javadir/tooldoc/commons_io/">apache FilenameUtils 文件名称操作</a></li>
<li class=""><a href="https://huachengzhou.github.io/cycle/javadir/tooldoc/dom4j/">dom4j</a></li>
<li class=""><a href="https://huachengzhou.github.io/cycle/javadir/tooldoc/guava-common/">Guava 基于java1.6的类库集合的扩展项目</a></li>
<li class=""><a href="https://huachengzhou.github.io/cycle/javadir/tooldoc/jsoup/">jsoup学习文档</a></li>
<li class=""><a href="https://huachengzhou.github.io/cycle/javadir/tooldoc/spring%E5%B7%A5%E5%85%B7/">spring工具类</a></li>
<li class=""><a href="https://huachengzhou.github.io/cycle/javadir/tooldoc/spring%E5%B8%B8%E7%94%A8%E7%9A%84%E5%B7%A5%E5%85%B7%E7%B1%BB/">spring常用的工具类</a></li>
<li class=""><a href="https://huachengzhou.github.io/cycle/javadir/tooldoc/js_console%E7%94%A8%E6%B3%95/">常用 Console 调试命令</a></li>
</ul>
  
</li>

<li class=""><a href="https://huachengzhou.github.io/cycle/javadir/linux/">linux 学习与使用 </a>
  
<ul class="sub-menu">
<li class=""><a href="https://huachengzhou.github.io/cycle/javadir/linux/git_introduction/">git学习</a></li>
<li class=""><a href="https://huachengzhou.github.io/cycle/javadir/linux/gitub_config/">git配置</a></li>
<li class=""><a href="https://huachengzhou.github.io/cycle/javadir/linux/host%E6%98%A0%E5%B0%84/">host映射</a></li>
<li class=""><a href="https://huachengzhou.github.io/cycle/javadir/linux/linux%E4%B8%8B%E8%AE%BE%E7%BD%AE%E5%92%8C%E6%9F%A5%E7%9C%8B%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/">Linux下设置和查看环境变量</a></li>
<li class=""><a href="https://huachengzhou.github.io/cycle/javadir/linux/linux%E5%91%BD%E4%BB%A4/">linux命令</a></li>
<li class=""><a href="https://huachengzhou.github.io/cycle/javadir/linux/nginx/">nginx学习</a></li>
<li class=""><a href="https://huachengzhou.github.io/cycle/javadir/linux/notepad&#43;&#43;%E5%AE%89%E8%A3%85/">Notepad&#43;&#43; 学习与使用</a></li>
<li class=""><a href="https://huachengzhou.github.io/cycle/javadir/linux/ubuntu16.04%E4%BF%AE%E6%94%B9hosts/">Ubuntu 16.04修改hosts</a></li>
<li class=""><a href="https://huachengzhou.github.io/cycle/javadir/linux/ubuntu%E5%AE%89%E8%A3%85chmsee/">ubuntu安装chmsee</a></li>
<li class=""><a href="https://huachengzhou.github.io/cycle/javadir/linux/ubuntu%E6%B8%85%E7%90%86%E7%B3%BB%E7%BB%9F%E5%9E%83%E5%9C%BE/">Ubuntu清理系统垃圾</a></li>
<li class=""><a href="https://huachengzhou.github.io/cycle/javadir/linux/ubuntu%E8%BD%AF%E4%BB%B6%E5%8D%B8%E8%BD%BD/">ubuntu软件卸载</a></li>
</ul>
  
</li>

<li class=""><a href="https://huachengzhou.github.io/cycle/javadir/middleware/">中间件 </a>
  
<ul class="sub-menu">
<li class=""><a href="https://huachengzhou.github.io/cycle/javadir/middleware/redis/">Redis 学习与使用</a></li>
</ul>
  
</li>
</ul>
  
</li>

<li class="parent"><a href="https://huachengzhou.github.io/cycle/databases/"> 数据库</a>
  
<ul class="sub-menu">

<li class="parent"><a href="https://huachengzhou.github.io/cycle/databases/mysql_163%E8%AF%BE%E5%A0%82/">网易云课堂MySQL微专业学习笔记</a>
  
<ul class="sub-menu">
<li class=""><a href="https://huachengzhou.github.io/cycle/databases/mysql_163%E8%AF%BE%E5%A0%82/%E7%BD%91%E6%98%93%E4%BA%91%E8%AF%BE%E5%A0%82mysql_chapter3/">MySQL事务与存储引擎</a></li>
<li class=""><a href="https://huachengzhou.github.io/cycle/databases/mysql_163%E8%AF%BE%E5%A0%82/%E7%BD%91%E6%98%93%E4%BA%91%E8%AF%BE%E5%A0%82mysql_chapter4/">MySQL应用优化</a></li>
<li class=""><a href="https://huachengzhou.github.io/cycle/databases/mysql_163%E8%AF%BE%E5%A0%82/%E7%BD%91%E6%98%93%E4%BA%91%E8%AF%BE%E5%A0%82mysql_chapter1/">MySQL数据库基础</a></li>
<li class="active"><a href="https://huachengzhou.github.io/cycle/databases/mysql_163%E8%AF%BE%E5%A0%82/%E7%BD%91%E6%98%93%E4%BA%91%E8%AF%BE%E5%A0%82mysql_chapter2/">MySQL数据库对象与应用</a></li>
<li class=""><a href="https://huachengzhou.github.io/cycle/databases/mysql_163%E8%AF%BE%E5%A0%82/%E7%BD%91%E6%98%93%E4%BA%91%E8%AF%BE%E5%A0%82mysql_chapter5/">MySQL运维实践</a></li>
</ul>
  
</li>
</ul>
  
</li>


</ul>
</nav>



<div class="sidebar-footer"></div>
</div>

</div><a href="#" id="backtothetop-fixed" class="backtothetop"
 data-backtothetop-duration="600"
 data-backtothetop-easing="easeOutQuart"
 data-backtothetop-fixed-fadeIn="1000"
 data-backtothetop-fixed-fadeOut="1000"
 data-backtothetop-fixed-bottom="10"
 data-backtothetop-fixed-right="20">
<span class="fa-layers fa-fw">
<i class="fas fa-circle"></i>
<i class="fas fa-arrow-circle-up"></i>
</span></a>
</div>
</body>
</html>
